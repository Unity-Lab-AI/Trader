<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medieval Trading Game</title>
    <link rel="stylesheet" href="src/css/styles.css?v=0.1">
    <link rel="stylesheet" href="src/css/ui-enhancements.css?v=0.1">
    <link rel="stylesheet" href="src/css/save-load-ui.css?v=0.1">
    <!-- ‚öôÔ∏è CONFIG MUST LOAD FIRST - All other scripts depend on it -->
    <script src="config.js?v=0.1"></script>
    <script>
        // Update document title from config immediately
        if (typeof GameConfig !== 'undefined') {
            document.title = GameConfig.game.name;
        }
    </script>
</head>
<body>
    <!-- Overlay Container for all modals and overlays -->
    <div id="overlay-container">
        <!-- World Map Overlay -->
        <div id="world-map-overlay" class="overlay">
            <div class="overlay-content">
                <button class="overlay-close" data-close-overlay="world-map-overlay">√ó</button>
                <div class="map-container">
                    <canvas id="world-map-overlay-canvas" width="1200" height="800"></canvas>
                    <div class="map-controls">
                        <button id="overlay-zoom-in-btn" title="Zoom In" onclick="if(typeof TravelSystem !== 'undefined' && TravelSystem.zoomIn) TravelSystem.zoomIn()">+</button>
                        <button id="overlay-zoom-out-btn" title="Zoom Out" onclick="if(typeof TravelSystem !== 'undefined' && TravelSystem.zoomOut) TravelSystem.zoomOut()">-</button>
                        <button id="overlay-reset-view-btn" title="Reset View" onclick="if(typeof TravelSystem !== 'undefined' && TravelSystem.resetView) TravelSystem.resetView()">‚ü≤</button>
                        <button id="overlay-toggle-grid-btn" title="Toggle Grid">‚äû</button>
                        <button id="overlay-center-player-btn" title="Center on Player" onclick="if(typeof TravelSystem !== 'undefined' && TravelSystem.autoFocusOnPlayer) TravelSystem.autoFocusOnPlayer()">üéØ</button>
                    </div>
                </div>
                <div id="overlay-location-details" class="location-details-panel hidden">
                    <!-- ‚ú® JS fills this with location info -->
                </div>
            </div>
        </div>

        <!-- ‚öôÔ∏è Settings Overlay - tweak your experience -->
        <div id="settings-overlay" class="overlay">
            <div class="overlay-content">
                <button class="overlay-close" data-close-overlay="settings-overlay">√ó</button>
                <h2>Game Settings</h2>
                <div id="settings-content">
                    <!-- üé® settings-panel.js does the heavy lifting here -->
                </div>
            </div>
        </div>

        <!-- üë§ Character Creation Overlay - define your tragic protagonist -->
        <div id="character-creation-overlay" class="overlay">
            <div class="overlay-content">
                <button class="overlay-close" data-close-overlay="character-creation-overlay">√ó</button>
                <h2>Create Your Character</h2>
                <div id="character-creation-content">
                    <!-- Character creation will be populated here -->
                </div>
            </div>
        </div>

        <!-- Market Overlay -->
        <div id="market-overlay" class="overlay">
            <div class="overlay-content">
                <button class="overlay-close" data-close-overlay="market-overlay">√ó</button>
                <h2>Market</h2>
                <div id="market-overlay-content">
                    <!-- Market content will be populated here -->
                </div>
            </div>
        </div>

        <!-- Inventory Overlay -->
        <div id="inventory-overlay" class="overlay">
            <div class="overlay-content">
                <button class="overlay-close" data-close-overlay="inventory-overlay">√ó</button>
                <h2>Inventory</h2>
                <div id="inventory-overlay-content">
                    <!-- Inventory content will be populated here -->
                </div>
            </div>
        </div>

        <!-- üö∂ Travel Progress Overlay - the journey (and the suffering) -->
        <div id="travel-progress-overlay" class="overlay">
            <div class="overlay-content">
                <h2>Travel Progress</h2>
                <div class="travel-progress">
                    <h3 id="travel-destination">Traveling to...</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="travel-progress-fill"></div>
                    </div>
                    <p>Distance: <span id="travel-distance">0</span> / <span id="travel-total-distance">0</span> miles</p>
                    <p>Time Remaining: <span id="travel-time-remaining">0</span> hours</p>
                    <p>Stats Drained:</p>
                    <div class="stat-drain">
                        <p>Hunger: <span id="hunger-drain">0</span></p>
                        <p>Thirst: <span id="thirst-drain">0</span></p>
                        <p>Fatigue: <span id="fatigue-drain">0</span></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- üé≤ Random Encounter Overlay - plot twists incoming -->
        <div id="random-encounter-overlay" class="overlay">
            <div class="overlay-content">
                <h2>Random Encounter</h2>
                <div class="encounter-content">
                    <h3 id="encounter-title">Encounter Title</h3>
                    <p id="encounter-description">Encounter description</p>
                    <div class="encounter-choices" id="encounter-choices">
                        <!-- Encounter choices will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚ú® Perk Selection Modal - choose your character's baggage -->
        <div id="perk-selection-modal" class="overlay">
            <div class="overlay-content perk-modal-content">
                <div class="perk-modal-header">
                    <h2>‚ö° Choose Your Perks</h2>
                    <button class="overlay-close" onclick="closePerkModal()">√ó</button>
                </div>
                <div class="perk-modal-body">
                    <div class="perk-modal-info">
                        <p>Select up to 2 perks that will shape your character's journey. Each perk provides unique bonuses and penalties.</p>
                        <div class="perk-selection-counter">
                            <span class="counter-label">Selected:</span>
                            <span class="counter-value"><span id="modal-selected-count">0</span> / 2</span>
                        </div>
                    </div>
                    <div id="perks-container" class="perks-modal-grid">
                        <!-- Perks will be populated by JavaScript -->
                    </div>
                </div>
                <div class="perk-modal-footer">
                    <button type="button" class="btn-secondary" onclick="closePerkModal()">Cancel</button>
                    <button type="button" class="btn-primary" onclick="confirmPerkSelection()">Confirm Selection</button>
                </div>
            </div>
        </div>

        <!-- üèÜ Achievement Panel - flex your accomplishments -->
        <div id="achievement-overlay" class="achievement-overlay" onclick="if(event.target === this) closeAchievementPanel()">
            <div class="achievement-panel" onclick="event.stopPropagation()">
                <div class="achievement-panel-header">
                    <div>
                        <h2 class="achievement-panel-title">üèÜ Achievements</h2>
                        <div class="achievement-progress">
                            <span id="achievement-progress-text">0 / 0 (0%)</span>
                            <div class="achievement-progress-bar">
                                <div id="achievement-progress-fill" class="achievement-progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <button class="close-achievement-panel" onclick="closeAchievementPanel(); event.stopPropagation();">‚úï Close</button>
                </div>

                <div class="achievement-categories">
                    <button class="achievement-category-btn active" data-category="all" onclick="filterAchievements(this, 'all')">All</button>
                    <button class="achievement-category-btn" data-category="wealth" onclick="filterAchievements(this, 'wealth')">üí∞ Wealth</button>
                    <button class="achievement-category-btn" data-category="trading" onclick="filterAchievements(this, 'trading')">ü§ù Trading</button>
                    <button class="achievement-category-btn" data-category="travel" onclick="filterAchievements(this, 'travel')">üó∫Ô∏è Travel</button>
                    <button class="achievement-category-btn" data-category="survival" onclick="filterAchievements(this, 'survival')">üõ°Ô∏è Survival</button>
                    <button class="achievement-category-btn" data-category="collection" onclick="filterAchievements(this, 'collection')">üéí Collection</button>
                    <button class="achievement-category-btn" data-category="time" onclick="filterAchievements(this, 'time')">‚è∞ Time</button>
                    <button class="achievement-category-btn" data-category="special" onclick="filterAchievements(this, 'special')">‚ú® Special</button>
                </div>

                <div id="achievement-grid" class="achievement-grid">
                    <!-- Achievements will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <div id="game-container" class="hidden">
        <!-- üñ§ TOP BAR - Time controls only, emoji style -->
        <div id="top-bar">
            <div class="time-controls-top">
                <button id="pause-btn" class="time-btn active" title="Pause">‚è∏Ô∏è</button>
                <button id="normal-speed-btn" class="time-btn" title="Normal Speed">‚ñ∂Ô∏è</button>
                <button id="fast-speed-btn" class="time-btn" title="Fast">‚è©</button>
                <button id="very-fast-speed-btn" class="time-btn" title="Very Fast">‚è≠Ô∏è</button>
            </div>
            <div class="top-bar-title" id="top-bar-title">Medieval Trading Game</div>
            <div class="top-bar-spacer"></div>
        </div>

        <!-- üéÆ MAIN GAME LAYOUT - side by side -->
        <div id="game-layout">
            <!-- üó∫Ô∏è GAME WORLD - now takes up most of the screen -->
            <main id="game-main">
                <section id="game-world">
                    <!-- World Map Container - EXPANDED -->
                    <div id="map-container" class="map-container">
                        <canvas id="world-map-canvas" width="1200" height="800"></canvas>
                        <div id="map-controls" class="map-controls">
                            <button id="zoom-in-btn" title="Zoom In" onclick="if(GameWorldRenderer) GameWorldRenderer.zoomIn()">+</button>
                            <button id="zoom-out-btn" title="Zoom Out" onclick="if(GameWorldRenderer) GameWorldRenderer.zoomOut()">-</button>
                            <button id="reset-view-btn" title="Reset View" onclick="if(GameWorldRenderer) GameWorldRenderer.resetView()">‚ü≤</button>
                            <button id="fullscreen-btn" title="Toggle Fullscreen" onclick="if(GameWorldRenderer) GameWorldRenderer.toggleFullscreen()">‚õ∂</button>
                            <button id="center-on-player-btn" title="Center on Player" onclick="if(GameWorldRenderer) GameWorldRenderer.centerOnPlayer()">üìç</button>
                        </div>
                    </div>

                    <!-- üìç Location Details Panel -->
                    <div id="location-details" class="location-details-panel hidden"></div>

                    <!-- Legacy canvas -->
                    <canvas id="game-canvas" width="800" height="600" class="hidden"></canvas>
                </section>
            </main>

            <!-- üìä RIGHT SIDE PANEL - Player info, stats, gold, time -->
            <aside id="side-panel">
                <div class="side-panel-section player-section">
                    <div class="player-name-display">
                        <span id="player-name">Player</span>
                    </div>
                    <div class="gold-display">
                        <span class="gold-icon">üí∞</span>
                        <span id="player-gold">100</span>
                    </div>
                    <div class="time-display-box">
                        <span class="time-icon">üïê</span>
                        <span id="game-time">Day 1, 08:00</span>
                    </div>
                </div>

                <div class="side-panel-section stats-section">
                    <div class="section-title">Stats</div>
                    <div class="stats-grid">
                        <div class="stat-item" title="Strength">
                            <span class="stat-icon">üí™</span>
                            <span class="stat-value" id="player-strength">5</span>
                        </div>
                        <div class="stat-item" title="Intelligence">
                            <span class="stat-icon">üß†</span>
                            <span class="stat-value" id="player-intelligence">5</span>
                        </div>
                        <div class="stat-item" title="Charisma">
                            <span class="stat-icon">üòä</span>
                            <span class="stat-value" id="player-charisma">5</span>
                        </div>
                        <div class="stat-item" title="Endurance">
                            <span class="stat-icon">üèÉ</span>
                            <span class="stat-value" id="player-endurance">5</span>
                        </div>
                        <div class="stat-item" title="Luck">
                            <span class="stat-icon">üçÄ</span>
                            <span class="stat-value" id="player-luck">5</span>
                        </div>
                    </div>
                </div>

                <div class="side-panel-section vitals-section">
                    <div class="section-title">Vitals</div>
                    <div class="vital-bar">
                        <span class="vital-icon">‚ù§Ô∏è</span>
                        <div class="vital-progress health-bar">
                            <div class="vital-fill" id="health-fill" style="width: 100%"></div>
                        </div>
                        <span class="vital-value" id="player-health-display">100</span>
                    </div>
                    <div class="vital-bar">
                        <span class="vital-icon">üçñ</span>
                        <div class="vital-progress hunger-bar">
                            <div class="vital-fill" id="hunger-fill" style="width: 100%"></div>
                        </div>
                        <span class="vital-value" id="player-hunger-display">100</span>
                    </div>
                    <div class="vital-bar">
                        <span class="vital-icon">üíß</span>
                        <div class="vital-progress thirst-bar">
                            <div class="vital-fill" id="thirst-fill" style="width: 100%"></div>
                        </div>
                        <span class="vital-value" id="player-thirst-display">100</span>
                    </div>
                    <div class="vital-bar">
                        <span class="vital-icon">üò¥</span>
                        <div class="vital-progress energy-bar">
                            <div class="vital-fill" id="energy-fill" style="width: 100%"></div>
                        </div>
                        <span class="vital-value" id="player-energy-display">100</span>
                    </div>
                </div>

                <div class="side-panel-section quick-actions">
                    <button id="menu-btn" class="side-btn">üìã Menu</button>
                    <button id="inventory-btn" class="side-btn">üéí Inventory [I]</button>
                    <button id="character-sheet-btn" class="side-btn" onclick="if(typeof KeyBindings !== 'undefined') KeyBindings.openCharacterSheet();">üë§ Character [C]</button>
                    <button id="financial-sheet-btn" class="side-btn" onclick="if(typeof KeyBindings !== 'undefined') KeyBindings.openFinancialSheet();">üí∞ Finances [F]</button>
                    <button id="property-employee-btn" class="side-btn" onclick="if(typeof KeyBindings !== 'undefined') KeyBindings.openProperties();">üè† Properties [P]</button>
                    <button id="ingame-settings-btn" class="side-btn" onclick="if(typeof SettingsPanel !== 'undefined' && SettingsPanel.show) SettingsPanel.show();">‚öôÔ∏è Settings [,]</button>
                </div>
            </aside>

            <!-- UI Panels Container - FLOATING over map -->
            <div id="ui-panels">
                <!-- Game Setup Panel -->
                <section id="game-setup-panel" class="panel hidden">
                    <div class="setup-header">
                        <h2>New Game Setup</h2>
                        <div class="setup-gold-display">
                            <span class="gold-icon">üí∞</span>
                            <span class="gold-label">Starting Gold:</span>
                            <span id="setup-gold-amount" class="gold-value">100</span>
                        </div>
                    </div>
                    <form id="game-setup-form">
                        <div class="form-group">
                            <label for="character-name-input">Character Name:</label>
                            <input type="text" id="character-name-input" required placeholder="Enter your character name">
                        </div>
                        
                        <!-- ‚öîÔ∏è Difficulty Selection - how much do you want to suffer? -->
                        <div class="form-group">
                            <label>Select Difficulty:</label>
                            <div class="difficulty-selection">
                                <div class="difficulty-option" data-difficulty="easy">
                                    <input type="radio" id="difficulty-easy" name="difficulty" value="easy">
                                    <label for="difficulty-easy">
                                        <h3>Easy</h3>
                                        <p>+20% starting gold, better prices, easier progression</p>
                                    </label>
                                </div>
                                <div class="difficulty-option" data-difficulty="normal">
                                    <input type="radio" id="difficulty-normal" name="difficulty" value="normal" checked>
                                    <label for="difficulty-normal">
                                        <h3>Normal</h3>
                                        <p>Standard gameplay experience (100 gold)</p>
                                    </label>
                                </div>
                                <div class="difficulty-option" data-difficulty="hard">
                                    <input type="radio" id="difficulty-hard" name="difficulty" value="hard">
                                    <label for="difficulty-hard">
                                        <h3>Hard</h3>
                                        <p>-20% starting gold, worse prices, harder progression</p>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        
                        <!-- ‚ú® Perk Selection - your character's special traits -->
                        <div class="form-group">
                            <label>Character Perks:</label>
                            <div class="perk-selection-info">
                                <p>Choose unique advantages and disadvantages that shape your character.</p>
                            </div>
                            <button type="button" id="open-perk-modal-btn" class="perk-selection-button" onclick="openPerkModal()">
                                <span class="perk-button-icon">‚ö°</span>
                                <span class="perk-button-text">Select Perks</span>
                                <span class="perk-counter-badge">
                                    <span id="selected-perks-count">0</span>/2
                                </span>
                            </button>
                            <div id="selected-perks-display" class="selected-perks-display">
                                <!-- Selected perks will be shown here -->
                            </div>
                        </div>
                        
                        <!-- üìä Character Attributes - min-max to your heart's content -->
                        <div class="attributes-display">
                            <div class="attributes-header">
                                <h3>Character Attributes</h3>
                                <div class="attribute-points-remaining">
                                    <span class="points-label">Points Remaining:</span>
                                    <span class="points-value" id="attr-points-remaining">5</span>
                                </div>
                            </div>
                            <div class="attributes-grid">
                                <div class="attribute">
                                    <span class="attribute-name">Strength</span>
                                    <div class="attribute-controls">
                                        <button type="button" class="attr-btn attr-down" data-attr="strength" onclick="decreaseAttribute('strength')">‚ñº</button>
                                        <span class="attribute-value" id="attr-strength">5</span>
                                        <button type="button" class="attr-btn attr-up" data-attr="strength" onclick="increaseAttribute('strength')">‚ñ≤</button>
                                    </div>
                                </div>
                                <div class="attribute">
                                    <span class="attribute-name">Intelligence</span>
                                    <div class="attribute-controls">
                                        <button type="button" class="attr-btn attr-down" data-attr="intelligence" onclick="decreaseAttribute('intelligence')">‚ñº</button>
                                        <span class="attribute-value" id="attr-intelligence">5</span>
                                        <button type="button" class="attr-btn attr-up" data-attr="intelligence" onclick="increaseAttribute('intelligence')">‚ñ≤</button>
                                    </div>
                                </div>
                                <div class="attribute">
                                    <span class="attribute-name">Charisma</span>
                                    <div class="attribute-controls">
                                        <button type="button" class="attr-btn attr-down" data-attr="charisma" onclick="decreaseAttribute('charisma')">‚ñº</button>
                                        <span class="attribute-value" id="attr-charisma">5</span>
                                        <button type="button" class="attr-btn attr-up" data-attr="charisma" onclick="increaseAttribute('charisma')">‚ñ≤</button>
                                    </div>
                                </div>
                                <div class="attribute">
                                    <span class="attribute-name">Endurance</span>
                                    <div class="attribute-controls">
                                        <button type="button" class="attr-btn attr-down" data-attr="endurance" onclick="decreaseAttribute('endurance')">‚ñº</button>
                                        <span class="attribute-value" id="attr-endurance">5</span>
                                        <button type="button" class="attr-btn attr-up" data-attr="endurance" onclick="increaseAttribute('endurance')">‚ñ≤</button>
                                    </div>
                                </div>
                                <div class="attribute">
                                    <span class="attribute-name">Luck</span>
                                    <div class="attribute-controls">
                                        <button type="button" class="attr-btn attr-down" data-attr="luck" onclick="decreaseAttribute('luck')">‚ñº</button>
                                        <span class="attribute-value" id="attr-luck">5</span>
                                        <button type="button" class="attr-btn attr-up" data-attr="luck" onclick="increaseAttribute('luck')">‚ñ≤</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" id="randomize-character-btn" class="secondary" onclick="console.log('üìç INLINE ONCLICK FIRED'); if(typeof window.randomizeCharacter === 'function') { window.randomizeCharacter(); } else { console.error('‚ùå window.randomizeCharacter not found, type:', typeof window.randomizeCharacter); }">Randomize</button>
                            <button type="button" id="start-game-btn" class="primary">Start Game</button>
                            <button type="button" id="cancel-setup-btn" class="secondary">Cancel</button>
                        </div>
                    </form>
                </section>

                <!-- üè™ Market Panel - medieval stock exchange but make it goth -->
                <section id="market-panel" class="panel hidden">
                    <div class="market-header">
                        <h2>Market</h2>
                        <div class="market-info">
                            <span id="market-location">Market</span>
                            <span id="market-reputation" class="reputation-display">Reputation: Neutral</span>
                        </div>
                        <div class="market-events" id="market-events">
                            <!-- Market events will be displayed here -->
                        </div>
                    </div>

                    <!-- Merchant Info -->
                    <div id="merchant-info-panel" class="merchant-info-panel">
                        <div class="merchant-greeting">
                            <span id="merchant-greeting-text">"Welcome to my shop!"</span>
                        </div>
                        <div class="merchant-details">
                            <div class="merchant-detail">
                                <span class="merchant-label">Merchant:</span>
                                <span id="merchant-name">Unknown</span>
                            </div>
                            <div class="merchant-detail">
                                <span class="merchant-label">Personality:</span>
                                <span id="merchant-personality">Friendly</span>
                            </div>
                            <div class="merchant-detail">
                                <span class="merchant-label">Relationship:</span>
                                <span id="merchant-relationship">‚ö™ Neutral</span>
                            </div>
                            <div class="merchant-detail">
                                <span class="merchant-label">Specialties:</span>
                                <span id="merchant-specialties">None</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Trading Controls -->
                    <div class="trading-controls">
                        <div class="trade-mode-toggle">
                            <button id="single-trade-btn" class="trade-mode-btn active">Single</button>
                            <button id="bulk-trade-btn" class="trade-mode-btn">Bulk</button>
                        </div>
                        <div class="trade-summary" id="trade-summary">
                            <span id="trade-total">Total: 0 gold</span>
                            <span id="trade-profit">Profit: 0 gold</span>
                        </div>
                    </div>
                    
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="buy">Buy</button>
                        <button class="tab-btn" data-tab="sell">Sell</button>
                        <button class="tab-btn" data-tab="compare">Compare</button>
                        <button class="tab-btn" data-tab="history">History</button>
                        <button class="tab-btn" data-tab="routes">Routes</button>
                        <button class="tab-btn" data-tab="alerts">Alerts</button>
                        <button class="tab-btn" data-tab="news">News</button>
                    </div>
                    
                    <div id="market-content">
                        <div id="buy-tab" class="tab-content active">
                            <div class="market-controls">
                                <button id="refresh-market-btn">Refresh Market</button>
                                <select id="item-filter">
                                    <option value="all">All Items</option>
                                    <option value="consumables">Consumables</option>
                                    <option value="resources">Resources</option>
                                    <option value="tools">Tools</option>
                                    <option value="luxury">Luxury</option>
                                </select>
                                <div class="bulk-controls hidden" id="bulk-buy-controls">
                                    <button id="select-all-buy-btn">Select All</button>
                                    <button id="clear-selection-buy-btn">Clear Selection</button>
                                    <button id="buy-selected-btn">Buy Selected</button>
                                </div>
                            </div>
                            <div id="buy-items" class="items-grid">
                                <!-- Items will be populated by JavaScript -->
                            </div>
                            <div id="trade-preview" class="trade-preview hidden">
                                <h4>Trade Preview</h4>
                                <div id="trade-preview-items"></div>
                                <div class="trade-total-info">
                                    <span>Total Cost: <span id="preview-total-cost">0</span> gold</span>
                                    <span>Total Weight: <span id="preview-total-weight">0</span> lbs</span>
                                </div>
                                <div class="trade-actions">
                                    <button id="confirm-trade-btn">Confirm Trade</button>
                                    <button id="cancel-trade-btn">Cancel</button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="sell-tab" class="tab-content">
                            <div class="market-controls">
                                <span id="sell-info">Sell your items for gold</span>
                                <div class="bulk-controls hidden" id="bulk-sell-controls">
                                    <button id="select-all-sell-btn">Select All</button>
                                    <button id="clear-selection-sell-btn">Clear Selection</button>
                                    <button id="sell-selected-btn">Sell Selected</button>
                                </div>
                            </div>
                            <div id="sell-items" class="items-grid">
                                <!-- Player items will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <div id="compare-tab" class="tab-content">
                            <div class="market-controls">
                                <select id="compare-item-select">
                                    <option value="">Select an item to compare</option>
                                </select>
                                <button id="update-comparison-btn">Update Comparison</button>
                                <button id="add-route-btn">Add to Route Planner</button>
                            </div>
                            <div id="price-comparison" class="price-comparison">
                                <!-- Price comparison will be displayed here -->
                            </div>
                        </div>
                        
                        <div id="history-tab" class="tab-content">
                            <div class="market-controls">
                                <button id="clear-history-btn">Clear History</button>
                                <button id="export-history-btn">Export History</button>
                            </div>
                            <div id="trade-history" class="trade-history">
                                <!-- Trade history will be displayed here -->
                            </div>
                        </div>
                        
                        <div id="routes-tab" class="tab-content">
                            <div class="market-controls">
                                <button id="plan-route-btn">Plan New Route</button>
                                <button id="clear-routes-btn">Clear Routes</button>
                            </div>
                            <div id="route-planner" class="route-planner">
                                <!-- Route planning will be displayed here -->
                            </div>
                        </div>
                        
                        <div id="alerts-tab" class="tab-content">
                            <div class="market-controls">
                                <button id="add-alert-btn">Add Price Alert</button>
                                <button id="clear-alerts-btn">Clear Alerts</button>
                            </div>
                            <div id="price-alerts" class="price-alerts">
                                <!-- Price alerts will be displayed here -->
                            </div>
                        </div>
                        
                        <div id="news-tab" class="tab-content">
                            <div class="market-controls">
                                <button id="refresh-news-btn">Refresh News</button>
                            </div>
                            <div id="market-news" class="market-news">
                                <!-- Market news will be displayed here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel-footer">
                        <button id="close-market-btn" data-close-overlay="market-panel">Close</button>
                    </div>
                </section>

                <!-- üéí Inventory Panel - all your worldly possessions -->
                <section id="inventory-panel" class="panel hidden">
                    <div class="inventory-header">
                        <h2>Inventory</h2>
                        <div class="inventory-controls">
                            <div class="inventory-info">
                                <span id="inventory-weight">Weight: 0/50 lbs</span>
                                <span id="inventory-value">Value: 0 gold</span>
                            </div>
                            <div class="inventory-actions">
                                <button id="sort-inventory-btn" title="Sort Inventory">üî§</button>
                                <button id="filter-inventory-btn" title="Filter Items">üîç</button>
                                <button id="inventory-settings-btn" title="Inventory Settings">‚öôÔ∏è</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Access Slots -->
                    <div class="quick-access-container">
                        <h3>Quick Access</h3>
                        <div id="quick-access-slots" class="quick-access-slots">
                            <!-- Quick access slots will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Inventory Filter and Sort Options -->
                    <div id="inventory-options" class="inventory-options hidden">
                        <div class="filter-section">
                            <label for="inventory-category-filter">Category:</label>
                            <select id="inventory-category-filter">
                                <option value="all">All Items</option>
                                <option value="consumables">Consumables</option>
                                <option value="tools">Tools</option>
                                <option value="weapons">Weapons</option>
                                <option value="resources">Resources</option>
                                <option value="luxury">Luxury</option>
                            </select>
                        </div>
                        <div class="sort-section">
                            <label for="inventory-sort-method">Sort By:</label>
                            <select id="inventory-sort-method">
                                <option value="name">Name</option>
                                <option value="value">Value</option>
                                <option value="weight">Weight</option>
                                <option value="quantity">Quantity</option>
                                <option value="category">Category</option>
                                <option value="rarity">Rarity</option>
                            </select>
                            <button id="inventory-sort-order" title="Toggle Sort Order">‚¨áÔ∏è</button>
                        </div>
                    </div>
                    
                    <!-- Inventory Grid -->
                    <div class="inventory-grid-container">
                        <div id="inventory-items" class="inventory-grid">
                            <!-- Inventory items will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Item Details Panel -->
                    <div id="item-details-panel" class="item-details-panel hidden">
                        <div class="item-details-header">
                            <h3 id="detail-item-name">Item Name</h3>
                            <button id="close-item-details" class="close-btn" data-close-overlay="item-details-panel">√ó</button>
                        </div>
                        <div class="item-details-content">
                            <div class="item-icon-large" id="detail-item-icon">üì¶</div>
                            <div class="item-info">
                                <p id="detail-item-description">Item description</p>
                                <div class="item-stats">
                                    <div class="item-stat">
                                        <span class="stat-label">Value:</span>
                                        <span id="detail-item-value">0 gold</span>
                                    </div>
                                    <div class="item-stat">
                                        <span class="stat-label">Weight:</span>
                                        <span id="detail-item-weight">0 lbs</span>
                                    </div>
                                    <div class="item-stat">
                                        <span class="stat-label">Quantity:</span>
                                        <span id="detail-item-quantity">0</span>
                                    </div>
                                    <div class="item-stat">
                                        <span class="stat-label">Category:</span>
                                        <span id="detail-item-category">None</span>
                                    </div>
                                    <div class="item-stat">
                                        <span class="stat-label">Rarity:</span>
                                        <span id="detail-item-rarity">Common</span>
                                    </div>
                                </div>
                                <div id="detail-item-effects" class="item-effects hidden">
                                    <h4>Effects:</h4>
                                    <div id="detail-effects-list"></div>
                                </div>
                            </div>
                        </div>
                        <div class="item-details-actions">
                            <button id="use-item-btn" class="action-btn">Use</button>
                            <button id="equip-item-btn" class="action-btn">Equip</button>
                            <button id="drop-item-btn" class="action-btn">Drop</button>
                            <button id="examine-item-btn" class="action-btn">Examine</button>
                            <button id="gift-item-btn" class="action-btn">Gift</button>
                        </div>
                    </div>
                    
                    <div class="panel-footer">
                        <button id="close-inventory-btn" data-close-overlay="inventory-panel">Close</button>
                    </div>
                </section>

                <!-- Location Info Panel -->
                <section id="location-panel" class="panel">
                    <h2 id="location-name">Town Square</h2>
                    <p id="location-description">You are in the town square.</p>
                    <div id="location-actions">
                        <button id="visit-market-btn">Visit Market</button>
                        <button id="travel-btn">Travel</button>
                        <button id="transportation-btn">Transportation</button>
                    </div>
                </section>

                <!-- üó∫Ô∏è Enhanced Travel Panel - journey into the unknown -->
                <section id="travel-panel" class="panel hidden">
                    <div class="travel-header">
                        <h2>Travel & Exploration</h2>
                        <div class="travel-tabs">
                            <button class="travel-tab-btn" data-travel-tab="destination">üéØ Destination</button>
                            <button class="travel-tab-btn active" data-travel-tab="destinations">üìç Locations</button>
                            <button class="travel-tab-btn" data-travel-tab="map">üó∫Ô∏è Map</button>
                            <button class="travel-tab-btn" id="open-world-map-overlay-btn">‚õ∂ Full Map</button>
                            <button class="travel-tab-btn" data-travel-tab="history">üìú History</button>
                        </div>
                    </div>

                    <div id="travel-content">
                        <!-- Destination Tab (Current Target) -->
                        <div id="destination-tab" class="travel-tab-content">
                            <div id="current-destination-display" class="destination-display">
                                <div class="no-destination">
                                    <span class="no-dest-icon">üéØ</span>
                                    <h3>No Destination Set</h3>
                                    <p>Click on a location in the Locations tab or Map to set a destination.</p>
                                </div>
                            </div>
                            <div id="destination-actions" class="destination-actions hidden">
                                <button id="travel-to-destination-btn" class="travel-btn-primary">üö∂ Travel Now</button>
                                <button id="fast-travel-destination-btn" class="travel-btn-secondary">‚ö° Fast Travel</button>
                                <button id="clear-destination-btn" class="travel-btn-danger">‚úï Clear</button>
                            </div>
                        </div>

                        <!-- Destinations Tab -->
                        <div id="destinations-tab" class="travel-tab-content active">
                            <div class="travel-controls">
                                <div class="travel-filter">
                                    <label for="destination-filter">Filter:</label>
                                    <select id="destination-filter">
                                        <option value="all">All Locations</option>
                                        <option value="connected">Connected Only</option>
                                        <option value="capital">üëë Capitals</option>
                                        <option value="city">üè∞ Cities</option>
                                        <option value="town">üèòÔ∏è Towns</option>
                                        <option value="village">üè† Villages</option>
                                        <option value="mine">‚õèÔ∏è Mines</option>
                                        <option value="forest">üå≤ Forests</option>
                                        <option value="port">‚öì Ports</option>
                                    </select>
                                </div>
                                <div class="travel-sort">
                                    <label for="destination-sort">Sort by:</label>
                                    <select id="destination-sort">
                                        <option value="distance">Distance</option>
                                        <option value="name">Name</option>
                                        <option value="type">Type</option>
                                    </select>
                                </div>
                            </div>
                            <div id="destinations" class="destinations-list">
                                <!-- Destinations will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Map Tab with Interactive Mini-Map -->
                        <div id="map-tab" class="travel-tab-content">
                            <!-- Interactive Mini-Map Container -->
                            <div id="travel-mini-map-container" class="travel-mini-map-container">
                                <div id="travel-mini-map" class="travel-mini-map"></div>
                                <div class="mini-map-controls">
                                    <button onclick="TravelPanelMap.zoomIn()" title="Zoom In">+</button>
                                    <button onclick="TravelPanelMap.zoomOut()" title="Zoom Out">‚àí</button>
                                    <button onclick="TravelPanelMap.centerOnPlayer()" title="Center on Player">üìç</button>
                                    <button onclick="TravelPanelMap.resetView()" title="Reset View">‚ü≤</button>
                                </div>
                            </div>
                            <!-- Map Legend (matches main world map) -->
                            <div class="travel-map-legend">
                                <h4>üó∫Ô∏è Map Legend</h4>
                                <div class="legend-grid">
                                    <div class="legend-item"><span class="legend-dot" style="background: #FFD700;"></span><span>üëë Capital</span></div>
                                    <div class="legend-item"><span class="legend-dot" style="background: #FF6B6B;"></span><span>üè∞ City</span></div>
                                    <div class="legend-item"><span class="legend-dot" style="background: #4ECDC4;"></span><span>üèòÔ∏è Town</span></div>
                                    <div class="legend-item"><span class="legend-dot" style="background: #95E77E;"></span><span>üè† Village</span></div>
                                    <div class="legend-item"><span class="legend-dot" style="background: #8B4513;"></span><span>‚õèÔ∏è Mine</span></div>
                                    <div class="legend-item"><span class="legend-dot" style="background: #228B22;"></span><span>üå≤ Forest</span></div>
                                    <div class="legend-item"><span class="legend-dot" style="background: #F4A460;"></span><span>üåæ Farm</span></div>
                                    <div class="legend-item"><span class="legend-dot" style="background: #1E90FF;"></span><span>‚öì Port</span></div>
                                    <div class="legend-item"><span class="legend-dot" style="background: #DAA520;"></span><span>üç∫ Inn</span></div>
                                    <div class="legend-item"><span class="legend-dot" style="background: #708090;"></span><span>üèõÔ∏è Ruins</span></div>
                                    <div class="legend-item"><span class="legend-dot" style="background: #4B0082;"></span><span>üíÄ Dungeon</span></div>
                                    <div class="legend-item"><span class="legend-dot" style="background: #CD853F;"></span><span>üõ°Ô∏è Outpost</span></div>
                                </div>
                                <div class="legend-info">
                                    <p>üìç <strong>You are here</strong> (pulsing marker)</p>
                                    <p>üéØ <strong>Destination</strong> (if set)</p>
                                    <p>Click a location to set as destination</p>
                                </div>
                            </div>
                        </div>

                        <!-- History Tab -->
                        <div id="history-tab" class="travel-tab-content">
                            <div class="history-controls">
                                <button id="clear-history-btn">üóëÔ∏è Clear History</button>
                                <button id="export-history-btn">üì§ Export</button>
                            </div>
                            <div id="travel-history" class="travel-history-list">
                                <!-- Travel history will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <div class="panel-footer">
                        <button id="close-travel-btn" data-close-overlay="travel-panel">Close</button>
                    </div>
                </section>

                <!-- üê¥ Transportation Panel - upgrade from walking sadly -->
                <section id="transportation-panel" class="panel hidden">
                    <h2>Transportation</h2>
                    <div class="transportation-info">
                        <p>Current Transport: <span id="current-transport">Backpack</span></p>
                        <p>Carry Capacity: <span id="carry-capacity">50 lbs</span></p>
                        <p>Current Load: <span id="current-load">0 lbs</span></p>
                    </div>
                    <h3>Available Transportation</h3>
                    <div id="transportation-options" class="items-grid">
                        <!-- Transportation options will be populated by JavaScript -->
                    </div>
                    <div class="panel-footer">
                        <button id="close-transportation-btn" data-close-overlay="transportation-panel">Close</button>
                    </div>
                </section>

                <!-- üè∞ Property & Employee Management - your medieval empire -->
                <section id="property-employee-panel" class="panel hidden">
                    <div class="property-employee-header">
                        <h2>Property & Employee Management</h2>
                        <div class="financial-summary">
                            <span id="property-income">Property Income: 0 gold/day</span>
                            <span id="employee-costs">Employee Costs: 0 gold/week</span>
                            <span id="net-profit">Net Profit: 0 gold/day</span>
                        </div>
                    </div>
                    
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="properties">Properties</button>
                        <button class="tab-btn" data-tab="employees">Employees</button>
                        <button class="tab-btn" data-tab="trade-routes">Trade Routes</button>
                        <button class="tab-btn" data-tab="financial">Financial</button>
                    </div>
                    
                    <div id="property-employee-content">
                        <!-- Properties Tab -->
                        <div id="properties-tab" class="tab-content active">
                            <div class="properties-controls">
                                <button id="buy-property-btn">Buy Property</button>
                                <button id="property-upgrades-btn">Manage Upgrades</button>
                                <button id="repair-all-btn">Repair All</button>
                            </div>
                            <div id="owned-properties" class="properties-grid">
                                <!-- Owned properties will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Employees Tab -->
                        <div id="employees-tab" class="tab-content">
                            <div class="employees-controls">
                                <button id="hire-employee-btn">Hire Employee</button>
                                <button id="employee-training-btn">Training</button>
                                <button id="pay-wages-btn">Pay Wages</button>
                            </div>
                            <div id="hired-employees" class="employees-grid">
                                <!-- Hired employees will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Trade Routes Tab -->
                        <div id="trade-routes-tab" class="tab-content">
                            <div class="trade-routes-controls">
                                <button id="create-route-btn">Create Route</button>
                                <button id="optimize-routes-btn">Optimize Routes</button>
                                <button id="route-history-btn">Route History</button>
                            </div>
                            <div id="active-routes" class="routes-grid">
                                <!-- Active trade routes will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Financial Tab -->
                        <div id="financial-tab" class="tab-content">
                            <div class="financial-overview">
                                <h3>Financial Overview</h3>
                                <div class="financial-stats">
                                    <div class="stat-item">
                                        <span class="stat-label">Daily Income:</span>
                                        <span id="daily-income" class="stat-value">0 gold</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Weekly Expenses:</span>
                                        <span id="weekly-expenses" class="stat-value">0 gold</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Property Value:</span>
                                        <span id="property-value" class="stat-value">0 gold</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Total Assets:</span>
                                        <span id="total-assets" class="stat-value">0 gold</span>
                                    </div>
                                </div>
                            </div>
                            <div class="financial-history">
                                <h3>Transaction History</h3>
                                <div id="transaction-history" class="transaction-list">
                                    <!-- Transaction history will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel-footer">
                        <button id="close-property-employee-btn" data-close-overlay="property-employee-panel">Close</button>
                    </div>
                </section>

                <!-- Property Details Modal -->
                <div id="property-details-modal" class="modal hidden">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 id="property-details-name">Property Name</h3>
                            <button id="close-property-details" class="close-btn" data-close-overlay="property-details-modal">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="property-info">
                                <div class="property-icon" id="property-details-icon">üè†</div>
                                <div class="property-stats">
                                    <div class="property-stat">
                                        <span class="stat-label">Type:</span>
                                        <span id="property-details-type">House</span>
                                    </div>
                                    <div class="property-stat">
                                        <span class="stat-label">Location:</span>
                                        <span id="property-details-location">Town</span>
                                    </div>
                                    <div class="property-stat">
                                        <span class="stat-label">Level:</span>
                                        <span id="property-details-level">1</span>
                                    </div>
                                    <div class="property-stat">
                                        <span class="stat-label">Condition:</span>
                                        <span id="property-details-condition">100%</span>
                                    </div>
                                    <div class="property-stat">
                                        <span class="stat-label">Income:</span>
                                        <span id="property-details-income">10 gold/day</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="property-upgrades">
                                <h4>Available Upgrades</h4>
                                <div id="property-upgrades-list" class="upgrades-list">
                                    <!-- Upgrades will be populated by JavaScript -->
                                </div>
                            </div>
                            
                            <div class="property-employees">
                                <h4>Assigned Employees</h4>
                                <div id="property-employees-list" class="employees-list">
                                    <!-- Assigned employees will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button id="repair-property-btn" class="action-btn">Repair</button>
                            <button id="upgrade-property-btn" class="action-btn">Upgrade</button>
                            <button id="sell-property-btn" class="action-btn danger">Sell</button>
                        </div>
                    </div>
                </div>

                <!-- Employee Details Modal -->
                <div id="employee-details-modal" class="modal hidden">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 id="employee-details-name">Employee Name</h3>
                            <button id="close-employee-details" class="close-btn" data-close-overlay="employee-details-modal">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="employee-info">
                                <div class="employee-avatar" id="employee-details-avatar">üë§</div>
                                <div class="employee-stats">
                                    <div class="employee-stat">
                                        <span class="stat-label">Type:</span>
                                        <span id="employee-details-type">Merchant</span>
                                    </div>
                                    <div class="employee-stat">
                                        <span class="stat-label">Level:</span>
                                        <span id="employee-details-level">1</span>
                                    </div>
                                    <div class="employee-stat">
                                        <span class="stat-label">Experience:</span>
                                        <span id="employee-details-experience">0/100</span>
                                    </div>
                                    <div class="employee-stat">
                                        <span class="stat-label">Morale:</span>
                                        <span id="employee-details-morale">Normal</span>
                                    </div>
                                    <div class="employee-stat">
                                        <span class="stat-label">Wage:</span>
                                        <span id="employee-details-wage">5 gold/week</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="employee-skills">
                                <h4>Skills</h4>
                                <div id="employee-skills-list" class="skills-list">
                                    <!-- Skills will be populated by JavaScript -->
                                </div>
                            </div>
                            
                            <div class="employee-assignment">
                                <h4>Current Assignment</h4>
                                <div id="employee-assignment-info" class="assignment-info">
                                    <!-- Assignment info will be populated by JavaScript -->
                                </div>
                                <div class="assignment-controls">
                                    <select id="assignment-property-select">
                                        <option value="">Select Property</option>
                                    </select>
                                    <button id="assign-employee-btn">Assign</button>
                                    <button id="unassign-employee-btn">Unassign</button>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button id="train-employee-btn" class="action-btn">Train</button>
                            <button id="promote-employee-btn" class="action-btn">Promote</button>
                            <button id="fire-employee-btn" class="action-btn danger">Fire</button>
                        </div>
                    </div>
                </div>

                <!-- üìú Message Log - the game talks to you here -->
                <section id="message-log">
                    <h3>Messages</h3>
                    <div id="messages">
                        <p class="message" id="welcome-message">Welcome to Medieval Trading Game!</p>
                    </div>
                </section>
            </div>
        </div>

        <!-- üéÆ Bottom Action Bar - compact row of action buttons -->
        <footer id="bottom-action-bar">
            <button id="bottom-market-btn" class="action-btn-bottom" title="Visit Market [M]" onclick="if(typeof KeyBindings !== 'undefined') KeyBindings.openMarket();">üè™</button>
            <button id="bottom-travel-btn" class="action-btn-bottom" title="Travel [T]" onclick="if(typeof KeyBindings !== 'undefined') KeyBindings.openTravel();">üó∫Ô∏è</button>
            <button id="bottom-transport-btn" class="action-btn-bottom" title="Transport [W]" onclick="if(typeof KeyBindings !== 'undefined') KeyBindings.openTransportation();">üöó</button>
            <button id="bottom-inventory-btn" class="action-btn-bottom" title="Inventory [I]" onclick="if(typeof KeyBindings !== 'undefined') KeyBindings.openInventory();">üéí</button>
            <button id="bottom-character-btn" class="action-btn-bottom" title="Character [C]" onclick="if(typeof KeyBindings !== 'undefined') KeyBindings.openCharacterSheet();">üë§</button>
            <button id="bottom-financial-btn" class="action-btn-bottom" title="Finances [F]" onclick="if(typeof KeyBindings !== 'undefined') KeyBindings.openFinancialSheet();">üí∞</button>
            <button id="bottom-achievements-btn" class="action-btn-bottom" title="Achievements" onclick="if(typeof openAchievementPanel === 'function') openAchievementPanel();">üèÜ</button>
            <button id="bottom-save-btn" class="action-btn-bottom" title="Save Game [F5]" onclick="if(typeof SaveUISystem !== 'undefined') SaveUISystem.openSaveAsDialog(); else if(typeof SaveLoadUI !== 'undefined') SaveLoadUI.show('saves');">üíæ</button>
            <button id="bottom-load-btn" class="action-btn-bottom" title="Load Game [F9]" onclick="if(typeof SaveUISystem !== 'undefined') SaveUISystem.openLoadGameDialog(); else if(typeof SaveLoadUI !== 'undefined') SaveLoadUI.show('load');">üìÇ</button>
        </footer>
    </div>

    <!-- ‚è≥ Loading Screen - please wait while we summon the medieval times -->
    <div id="loading-screen" class="screen hidden">
        <div class="loading-content">
            <h2 id="loading-title">Loading Medieval Trading Game...</h2>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
        </div>
    </div>

    <!-- üè† Main Menu - where it all begins (again) -->
    <div id="main-menu" class="screen">
        <div class="menu-content">
            <h1 id="main-menu-title">Medieval Trading Game</h1>
            <p id="main-menu-version" class="version-text"></p>
            <div class="menu-buttons">
                <button id="new-game-btn">New Game</button>
                <button id="load-game-btn" disabled>Load Game</button>
                <button id="settings-btn">Settings</button>
            </div>
        </div>
    </div>

    <!-- üêõ DEBUG CONSOLE - ON-SCREEN CONSOLE LOG -->
    <div id="debug-console" style="position: fixed; bottom: 0; right: 0; width: 600px; height: 80vh; max-height: 800px; background: rgba(0,0,0,0.95); color: #0f0; font-family: monospace; font-size: 11px; z-index: 99999; border: 2px solid #0f0; display: none; flex-direction: column;">
        <!-- Header -->
        <div style="display: flex; justify-content: space-between; padding: 8px 10px; border-bottom: 1px solid #0f0; background: rgba(0,0,0,0.98); flex-shrink: 0;">
            <strong style="color: #0ff;">üêõ DEBUG CONSOLE (Press ` for commands)</strong>
            <button onclick="document.getElementById('debug-console').style.display='none'" style="background: #f00; color: #fff; border: none; padding: 2px 8px; cursor: pointer;">Close</button>
        </div>
        <!-- Scrollable Log Content -->
        <div id="debug-console-content" style="flex: 1; overflow-y: auto; padding: 10px; font-size: 10px; line-height: 1.4;"></div>
        <!-- Command Input (Fixed at Bottom) -->
        <div id="debug-command-container" style="display: flex; gap: 8px; align-items: center; padding: 8px 10px; border-top: 2px solid #0f0; background: rgba(0,20,0,0.98); flex-shrink: 0;">
            <span style="color: #0ff; font-weight: bold; font-size: 14px;">></span>
            <input type="text"
                   id="debug-command-input"
                   placeholder="Type command... (` to focus, Enter to run, Tab to autocomplete)"
                   style="flex: 1; background: rgba(0,40,0,0.8); border: 1px solid #0f0; color: #0f0; font-family: monospace; font-size: 12px; padding: 8px 10px; outline: none; border-radius: 4px;"
                   autocomplete="off"
                   spellcheck="false"
            />
            <button id="debug-command-execute" style="background: #0a0; border: 1px solid #0f0; color: #fff; padding: 8px 12px; cursor: pointer; font-family: monospace; font-size: 12px; border-radius: 4px;">Run</button>
            <button id="debug-command-help" style="background: #005; border: 1px solid #0ff; color: #0ff; padding: 8px 12px; cursor: pointer; font-family: monospace; font-size: 12px; border-radius: 4px;">?</button>
        </div>
    </div>
    <button id="toggle-debug-console" onclick="var dc = document.getElementById('debug-console'); dc.style.display = dc.style.display === 'none' ? 'flex' : 'none'" style="position: fixed; bottom: 10px; right: 10px; z-index: 99998; background: #000; color: #0f0; border: 2px solid #0f0; padding: 10px; cursor: pointer; font-family: monospace;">
        üêõ DEBUG
    </button>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         ‚ö°‚ö°‚ö° CRITICAL: CORE DEPENDENCIES - MUST LOAD FIRST ‚ö°‚ö°‚ö°
         EventManager and TimerManager are used by ALL other systems
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <script src="src/js/event-manager.js?v=0.1"></script>
    <script src="src/js/timer-manager.js?v=0.1"></script>

    <!-- üõ†Ô∏è Browser Utilities (depend on EventManager) -->
    <script src="src/js/browser-compatibility.js?v=0.1"></script>
    <script src="src/js/modal-system.js?v=0.1"></script>

    <!-- üìä Data Systems (depend on EventManager + TimerManager) -->
    <script src="src/js/item-database.js?v=0.1"></script>
    <script src="src/js/unified-item-system.js?v=0.1"></script>
    <script src="src/js/crafting-economy-system.js?v=0.1"></script>
    <script src="src/js/market-price-history.js?v=0.1"></script>
    <script src="src/js/dynamic-market-system.js?v=0.1"></script>

    <!-- üèõÔ∏è City Systems -->
    <script src="src/js/city-reputation-system.js?v=0.1"></script>
    <script src="src/js/city-event-system.js?v=0.1"></script>

    <!-- üíº Business Systems -->
    <script src="src/js/trading-system.js?v=0.1"></script>
    <script src="src/js/inventory-system.js?v=0.1"></script>
    <script src="src/js/npc-merchant-system.js?v=0.1"></script>

    <!-- üèóÔ∏è Property & Employee Systems -->
    <script src="src/js/property-system.js?v=0.1"></script>
    <script src="src/js/employee-system.js?v=0.1"></script>
    <script src="src/js/property-employee-bridge.js?v=0.1"></script>
    <script src="src/js/property-employee-ui.js?v=0.1"></script>

    <!-- üó∫Ô∏è Travel & Routes -->
    <script src="src/js/travel-system.js?v=0.1"></script>
    <script src="src/js/trade-route-system.js?v=0.1"></script>

    <!-- üè∞ Gatehouse & Resource Gathering Systems -->
    <script src="src/js/gatehouse-system.js?v=0.1"></script>
    <script src="src/js/resource-gathering-system.js?v=0.1"></script>

    <!-- üñ§ Game World Renderer - where the map magic happens -->
    <script src="src/js/game-world-renderer.js?v=0.1"></script>
    <script src="src/js/travel-panel-map.js?v=0.1"></script>

    <!-- üéØ Achievement System -->
    <script src="src/js/achievement-system.js?v=0.1"></script>

    <!-- üé® UI & Polish Systems -->
    <script src="src/js/ui-enhancements.js?v=0.1"></script>
    <script src="src/js/ui-polish-system.js?v=0.1"></script>
    <script src="src/js/button-fix.js?v=0.1"></script>
    <script src="src/js/settings-panel.js?v=0.1"></script>
    <script src="src/js/draggable-panels.js?v=0.1"></script>
    <script src="src/js/panel-manager.js?v=0.1"></script>

    <!-- üíæ Save/Load Systems -->
    <script src="src/js/save-load-system.js?v=0.1"></script>
    <script src="src/js/save-ui-system.js?v=0.1"></script>
    <script src="src/js/save-load-ui.js?v=0.1"></script>

    <!-- üé¨ Immersive Experience Systems -->
    <script src="src/js/visual-effects-system.js?v=0.1"></script>
    <script src="src/js/audio-system.js?v=0.1"></script>
    <script src="src/js/animation-system.js?v=0.1"></script>
    <script src="src/js/environmental-effects-system.js?v=0.1"></script>
    <script src="src/js/immersive-experience-integration.js?v=0.1"></script>

    <!-- ‚ö° Performance Optimizer -->
    <script src="src/js/performance-optimizer.js?v=0.1"></script>

    <!-- üéÆ CORE GAME - Must load LAST (depends on all systems above) -->
    <script src="src/js/game.js?v=0.1"></script>

    <!-- üéÆ GAME ENGINE - Orchestrates time, travel, and game loop -->
    <script src="src/js/game-engine.js?v=0.1"></script>

    <!-- üéÆ DEBUG COMMAND SYSTEM - Cheat codes and developer tools -->
    <script src="src/js/debug-command-system.js?v=0.1"></script>

    <script>
        // Initialize the property-employee bridge after all systems are loaded
        if (typeof PropertyEmployeeBridge !== 'undefined') {
            PropertyEmployeeBridge.init();
        }

        // Apply GameConfig values to UI elements
        if (typeof GameConfig !== 'undefined') {
            // Update document title
            document.title = GameConfig.game.name;

            // Update main menu title and version
            const mainMenuTitle = document.getElementById('main-menu-title');
            if (mainMenuTitle) mainMenuTitle.textContent = GameConfig.game.name;

            const versionText = document.getElementById('main-menu-version');
            if (versionText) versionText.textContent = GameConfig.getVersionString();

            // Update top bar title
            const topBarTitle = document.getElementById('top-bar-title');
            if (topBarTitle) topBarTitle.textContent = GameConfig.ui.topBarTitle;

            // Update loading title
            const loadingTitle = document.getElementById('loading-title');
            if (loadingTitle) loadingTitle.textContent = GameConfig.ui.loadingMessage;

            // Update welcome message
            const welcomeMsg = document.getElementById('welcome-message');
            if (welcomeMsg) welcomeMsg.textContent = GameConfig.ui.welcomeMessage;

            console.log(`üéÆ ${GameConfig.game.name} v${GameConfig.version.game} initialized`);
            console.log(`üè¢ Made by ${GameConfig.credits.studio}`);
        }
    </script>
</body>
</html>
