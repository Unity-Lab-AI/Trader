<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Game</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="game-container">
        <header id="game-header">
            <h1>Trading Game</h1>
            <div id="player-info">
                <div class="player-main-info">
                    <span id="player-name">Player</span>
                    <span id="player-gold">Gold: 100</span>
                    <span id="game-time" class="time-display">Day 1, 08:00</span>
                </div>
                <div class="player-attributes">
                    <span class="attribute-display" title="Strength">üí™ <span id="player-strength">5</span></span>
                    <span class="attribute-display" title="Intelligence">üß† <span id="player-intelligence">5</span></span>
                    <span class="attribute-display" title="Charisma">üòä <span id="player-charisma">5</span></span>
                    <span class="attribute-display" title="Endurance">üèÉ <span id="player-endurance">5</span></span>
                    <span class="attribute-display" title="Luck">üçÄ <span id="player-luck">5</span></span>
                </div>
                <div class="quick-actions" aria-label="Quick actions">
                    <button id="quick-save-btn" class="quick-action-btn" title="Quick Save (Ctrl+S)">üíæ Quick Save</button>
                    <button id="quick-load-btn" class="quick-action-btn" title="Quick Load (Ctrl+L)">üìÇ Quick Load</button>
                    <button id="undo-btn" class="quick-action-btn" title="Undo last action (Ctrl+Z)">‚Ü©Ô∏è Undo</button>
                    <button id="redo-btn" class="quick-action-btn" title="Redo last action (Ctrl+Shift+Z)">‚Ü™Ô∏è Redo</button>
                    <button id="controls-help-btn" class="quick-action-btn" title="Show control help (Shift + /)">‚ùî Controls</button>
                    <button id="onboarding-btn" class="quick-action-btn" title="Replay the guided tour">üéì Tour</button>
                    <button id="in-game-settings-btn" class="quick-action-btn" title="Adjust accessibility and preferences">‚öôÔ∏è Settings</button>
                    <div id="status-banner" class="status-banner hidden" role="status" aria-live="polite">Saved</div>
                    <div id="controller-status" class="controller-status" role="status" aria-live="polite">Controller: None</div>
                </div>
                <div class="save-indicators" aria-live="polite">
                    <span id="autosave-indicator" class="save-indicator hidden">
                        <span class="spinner" aria-hidden="true"></span>
                        <span class="autosave-text">Auto-saving...</span>
                    </span>
                    <span id="last-save-time" class="save-indicator subtle">Last save: never</span>
                </div>
            </div>
        </header>

        <section id="world-status" aria-label="World status">
            <div class="status-pill">
                <span class="pill-label">Weather</span>
                <span id="weather-label">Calm Skies</span>
            </div>
            <div class="status-pill">
                <span class="pill-label">Season</span>
                <span id="season-label">Spring</span>
            </div>
            <div class="status-pill">
                <span class="pill-label">Cycle</span>
                <span id="cycle-label">Dawn</span>
            </div>
            <div class="status-pill">
                <span class="pill-label">Stance</span>
                <span id="animation-state">Idle</span>
            </div>
            <div class="status-pill">
                <span class="pill-label">Momentum</span>
                <span id="animation-momentum">Stable</span>
            </div>
            <div class="status-pill atmosphere" id="atmosphere-note">Atmosphere steady and safe.</div>
            <div class="status-pill fidelity">
                <span class="pill-label">Fidelity</span>
                <span id="quality-label">High</span>
            </div>
        </section>

        <main id="game-main">
            <!-- Game World Area -->
            <section id="game-world">
                <!-- World Map Container -->
                <div id="map-container" class="map-container">
                    <canvas id="world-map-canvas" width="800" height="600"></canvas>
                    <div id="map-controls" class="map-controls">
                        <button id="zoom-in-btn" title="Zoom In">+</button>
                        <button id="zoom-out-btn" title="Zoom Out">-</button>
                        <button id="reset-view-btn" title="Reset View">‚ü≤</button>
                        <button id="toggle-grid-btn" title="Toggle Grid">‚äû</button>
                    </div>
                </div>
                
                <!-- Location Details Panel -->
                <div id="location-details" class="location-details-panel hidden">
                    <!-- Location details will be populated by JavaScript -->
                </div>
                
                <!-- Legacy game canvas (kept for compatibility) -->
                <canvas id="game-canvas" width="800" height="600" class="hidden"></canvas>
            </section>

            <!-- UI Panels Container -->
            <div id="ui-panels">
                <!-- Game Setup Panel -->
                <section id="game-setup-panel" class="panel hidden">
                    <h2>New Game Setup</h2>
                    <form id="game-setup-form">
                        <div class="form-group">
                            <label for="character-name-input">Character Name:</label>
                            <input type="text" id="character-name-input" required placeholder="Enter your character name">
                        </div>
                        
                        <!-- Difficulty Selection -->
                        <div class="form-group">
                            <label>Select Difficulty:</label>
                            <div class="difficulty-selection">
                                <div class="difficulty-option" data-difficulty="easy">
                                    <input type="radio" id="difficulty-easy" name="difficulty" value="easy">
                                    <label for="difficulty-easy">
                                        <h3>Easy</h3>
                                        <p>20% better prices, more starting gold, easier progression</p>
                                    </label>
                                </div>
                                <div class="difficulty-option" data-difficulty="normal">
                                    <input type="radio" id="difficulty-normal" name="difficulty" value="normal" checked>
                                    <label for="difficulty-normal">
                                        <h3>Normal</h3>
                                        <p>Standard gameplay experience</p>
                                    </label>
                                </div>
                                <div class="difficulty-option" data-difficulty="hard">
                                    <input type="radio" id="difficulty-hard" name="difficulty" value="hard">
                                    <label for="difficulty-hard">
                                        <h3>Hard</h3>
                                        <p>20% worse prices, less starting gold, harder progression</p>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Character Visual Representation -->
                        <div class="character-visual">
                            <div class="character-avatar" id="character-avatar">
                                <span class="avatar-icon">üßë</span>
                            </div>
                            <div class="character-preview">
                                <h3 id="preview-name">Your Character</h3>
                                <div class="starting-gold-display">
                                    <span class="gold-label">Starting Gold:</span>
                                    <span id="starting-gold-amount" class="gold-amount">100</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Perk Selection -->
                        <div class="form-group">
                            <label>Select Your Perks (Choose up to 2):</label>
                            <div class="perk-selection-info">
                                <p>Perks provide unique advantages and disadvantages that affect your gameplay.</p>
                                <div class="perk-counter">
                                    <span id="selected-perks-count">0</span> / 2 perks selected
                                </div>
                            </div>
                            <div id="perks-container" class="perks-grid">
                                <!-- Perks will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Character Attributes Display -->
                        <div class="attributes-display">
                            <h3>Character Attributes</h3>
                            <div class="attributes-grid">
                                <div class="attribute">
                                    <span class="attribute-name">Strength</span>
                                    <span class="attribute-value" id="attr-strength">5</span>
                                </div>
                                <div class="attribute">
                                    <span class="attribute-name">Intelligence</span>
                                    <span class="attribute-value" id="attr-intelligence">5</span>
                                </div>
                                <div class="attribute">
                                    <span class="attribute-name">Charisma</span>
                                    <span class="attribute-value" id="attr-charisma">5</span>
                                </div>
                                <div class="attribute">
                                    <span class="attribute-name">Endurance</span>
                                    <span class="attribute-value" id="attr-endurance">5</span>
                                </div>
                                <div class="attribute">
                                    <span class="attribute-name">Luck</span>
                                    <span class="attribute-value" id="attr-luck">5</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" id="randomize-character-btn" class="secondary">Randomize</button>
                            <button type="submit" id="create-character-btn">Start Adventure</button>
                        </div>
                    </form>
                </section>

                <!-- Market Panel -->
                <section id="market-panel" class="panel hidden">
                    <div class="market-header">
                        <h2>Market</h2>
                        <div class="market-info">
                            <span id="market-location">Market</span>
                            <span id="market-reputation" class="reputation-display">Reputation: Neutral</span>
                        </div>
                        <div class="market-events" id="market-events">
                            <!-- Market events will be displayed here -->
                        </div>
                    </div>
                    
                    <!-- Trading Controls -->
                    <div class="trading-controls">
                        <div class="trade-mode-toggle">
                            <button id="single-trade-btn" class="trade-mode-btn active">Single</button>
                            <button id="bulk-trade-btn" class="trade-mode-btn">Bulk</button>
                        </div>
                        <div class="trade-summary" id="trade-summary">
                            <span id="trade-total">Total: 0 gold</span>
                            <span id="trade-profit">Profit: 0 gold</span>
                        </div>
                    </div>
                    
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="buy">Buy</button>
                        <button class="tab-btn" data-tab="sell">Sell</button>
                        <button class="tab-btn" data-tab="compare">Compare</button>
                        <button class="tab-btn" data-tab="history">History</button>
                        <button class="tab-btn" data-tab="routes">Routes</button>
                        <button class="tab-btn" data-tab="alerts">Alerts</button>
                        <button class="tab-btn" data-tab="news">News</button>
                    </div>
                    
                    <div id="market-content">
                        <div id="buy-tab" class="tab-content active">
                            <div class="market-controls">
                                <button id="refresh-market-btn">Refresh Market</button>
                                <select id="item-filter">
                                    <option value="all">All Items</option>
                                    <option value="consumables">Consumables</option>
                                    <option value="resources">Resources</option>
                                    <option value="tools">Tools</option>
                                    <option value="luxury">Luxury</option>
                                </select>
                                <div class="bulk-controls hidden" id="bulk-buy-controls">
                                    <button id="select-all-buy-btn">Select All</button>
                                    <button id="clear-selection-buy-btn">Clear Selection</button>
                                    <button id="buy-selected-btn">Buy Selected</button>
                                </div>
                            </div>
                            <div id="buy-items" class="items-grid">
                                <!-- Items will be populated by JavaScript -->
                            </div>
                            <div id="trade-preview" class="trade-preview hidden">
                                <h4>Trade Preview</h4>
                                <div id="trade-preview-items"></div>
                                <div class="trade-total-info">
                                    <span>Total Cost: <span id="preview-total-cost">0</span> gold</span>
                                    <span>Total Weight: <span id="preview-total-weight">0</span> lbs</span>
                                </div>
                                <div class="trade-actions">
                                    <button id="confirm-trade-btn">Confirm Trade</button>
                                    <button id="cancel-trade-btn">Cancel</button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="sell-tab" class="tab-content">
                            <div class="market-controls">
                                <span id="sell-info">Sell your items for gold</span>
                                <div class="bulk-controls hidden" id="bulk-sell-controls">
                                    <button id="select-all-sell-btn">Select All</button>
                                    <button id="clear-selection-sell-btn">Clear Selection</button>
                                    <button id="sell-selected-btn">Sell Selected</button>
                                </div>
                            </div>
                            <div id="sell-items" class="items-grid">
                                <!-- Player items will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <div id="compare-tab" class="tab-content">
                            <div class="market-controls">
                                <select id="compare-item-select">
                                    <option value="">Select an item to compare</option>
                                </select>
                                <button id="update-comparison-btn">Update Comparison</button>
                                <button id="add-route-btn">Add to Route Planner</button>
                            </div>
                            <div id="price-comparison" class="price-comparison">
                                <!-- Price comparison will be displayed here -->
                            </div>
                        </div>
                        
                        <div id="history-tab" class="tab-content">
                            <div class="market-controls">
                                <button id="clear-history-btn">Clear History</button>
                                <button id="export-history-btn">Export History</button>
                            </div>
                            <div id="trade-history" class="trade-history">
                                <!-- Trade history will be displayed here -->
                            </div>
                        </div>
                        
                        <div id="routes-tab" class="tab-content">
                            <div class="market-controls">
                                <button id="plan-route-btn">Plan New Route</button>
                                <button id="clear-routes-btn">Clear Routes</button>
                            </div>
                            <div id="route-planner" class="route-planner">
                                <!-- Route planning will be displayed here -->
                            </div>
                        </div>
                        
                        <div id="alerts-tab" class="tab-content">
                            <div class="market-controls">
                                <button id="add-alert-btn">Add Price Alert</button>
                                <button id="clear-alerts-btn">Clear Alerts</button>
                            </div>
                            <div id="price-alerts" class="price-alerts">
                                <!-- Price alerts will be displayed here -->
                            </div>
                        </div>
                        
                        <div id="news-tab" class="tab-content">
                            <div class="market-controls">
                                <button id="refresh-news-btn">Refresh News</button>
                            </div>
                            <div id="market-news" class="market-news">
                                <!-- Market news will be displayed here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel-footer">
                        <button id="close-market-btn">Close</button>
                    </div>
                </section>

                <!-- Inventory Panel -->
                <section id="inventory-panel" class="panel hidden">
                    <div class="inventory-header">
                        <h2>Inventory</h2>
                        <div class="inventory-controls">
                            <div class="inventory-info">
                                <span id="inventory-weight">Weight: 0/50 lbs</span>
                                <span id="inventory-value">Value: 0 gold</span>
                            </div>
                            <div class="inventory-actions">
                                <button id="sort-inventory-btn" title="Sort Inventory">üî§</button>
                                <button id="filter-inventory-btn" title="Filter Items">üîç</button>
                                <button id="inventory-settings-btn" title="Inventory Settings">‚öôÔ∏è</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Access Slots -->
                    <div class="quick-access-container">
                        <h3>Quick Access</h3>
                        <div id="quick-access-slots" class="quick-access-slots">
                            <!-- Quick access slots will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Inventory Filter and Sort Options -->
                    <div id="inventory-options" class="inventory-options hidden">
                        <div class="filter-section">
                            <label for="inventory-category-filter">Category:</label>
                            <select id="inventory-category-filter">
                                <option value="all">All Items</option>
                                <option value="consumables">Consumables</option>
                                <option value="tools">Tools</option>
                                <option value="weapons">Weapons</option>
                                <option value="resources">Resources</option>
                                <option value="luxury">Luxury</option>
                            </select>
                        </div>
                        <div class="sort-section">
                            <label for="inventory-sort-method">Sort By:</label>
                            <select id="inventory-sort-method">
                                <option value="name">Name</option>
                                <option value="value">Value</option>
                                <option value="weight">Weight</option>
                                <option value="quantity">Quantity</option>
                                <option value="category">Category</option>
                                <option value="rarity">Rarity</option>
                            </select>
                            <button id="inventory-sort-order" title="Toggle Sort Order">‚¨áÔ∏è</button>
                        </div>
                    </div>
                    
                    <!-- Inventory Grid -->
                    <div class="inventory-grid-container">
                        <div id="inventory-items" class="inventory-grid">
                            <!-- Inventory items will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Item Details Panel -->
                    <div id="item-details-panel" class="item-details-panel hidden">
                        <div class="item-details-header">
                            <h3 id="detail-item-name">Item Name</h3>
                            <button id="close-item-details" class="close-btn">√ó</button>
                        </div>
                        <div class="item-details-content">
                            <div class="item-icon-large" id="detail-item-icon">üì¶</div>
                            <div class="item-info">
                                <p id="detail-item-description">Item description</p>
                                <div class="item-stats">
                                    <div class="item-stat">
                                        <span class="stat-label">Value:</span>
                                        <span id="detail-item-value">0 gold</span>
                                    </div>
                                    <div class="item-stat">
                                        <span class="stat-label">Weight:</span>
                                        <span id="detail-item-weight">0 lbs</span>
                                    </div>
                                    <div class="item-stat">
                                        <span class="stat-label">Quantity:</span>
                                        <span id="detail-item-quantity">0</span>
                                    </div>
                                    <div class="item-stat">
                                        <span class="stat-label">Category:</span>
                                        <span id="detail-item-category">None</span>
                                    </div>
                                    <div class="item-stat">
                                        <span class="stat-label">Rarity:</span>
                                        <span id="detail-item-rarity">Common</span>
                                    </div>
                                </div>
                                <div id="detail-item-effects" class="item-effects hidden">
                                    <h4>Effects:</h4>
                                    <div id="detail-effects-list"></div>
                                </div>
                            </div>
                        </div>
                        <div class="item-details-actions">
                            <button id="use-item-btn" class="action-btn">Use</button>
                            <button id="equip-item-btn" class="action-btn">Equip</button>
                            <button id="drop-item-btn" class="action-btn">Drop</button>
                            <button id="examine-item-btn" class="action-btn">Examine</button>
                            <button id="gift-item-btn" class="action-btn">Gift</button>
                        </div>
                    </div>
                    
                    <div class="panel-footer">
                        <button id="close-inventory-btn">Close</button>
                    </div>
                </section>

                <!-- Location Info Panel -->
                <section id="location-panel" class="panel">
                    <h2 id="location-name">Town Square</h2>
                    <p id="location-description">You are in the town square.</p>
                    <div id="location-actions">
                        <button id="visit-market-btn">Visit Market</button>
                        <button id="travel-btn">Travel</button>
                        <button id="transportation-btn">Transportation</button>
                    </div>
                </section>

                <!-- Enhanced Travel Panel -->
                <section id="travel-panel" class="panel hidden">
                    <div class="travel-header">
                        <h2>Travel & Exploration</h2>
                        <div class="travel-tabs">
                            <button class="travel-tab-btn active" data-travel-tab="destinations">Destinations</button>
                            <button class="travel-tab-btn" data-travel-tab="map">World Map</button>
                            <button class="travel-tab-btn" data-travel-tab="resources">Resources</button>
                            <button class="travel-tab-btn" data-travel-tab="history">History</button>
                        </div>
                    </div>
                    
                    <div id="travel-content">
                        <!-- Destinations Tab -->
                        <div id="destinations-tab" class="travel-tab-content active">
                            <div class="travel-controls">
                                <div class="travel-filter">
                                    <label for="destination-filter">Filter:</label>
                                    <select id="destination-filter">
                                        <option value="all">All Locations</option>
                                        <option value="city">Cities</option>
                                        <option value="town">Towns</option>
                                        <option value="village">Villages</option>
                                    </select>
                                </div>
                                <div class="travel-sort">
                                    <label for="destination-sort">Sort by:</label>
                                    <select id="destination-sort">
                                        <option value="distance">Distance</option>
                                        <option value="name">Name</option>
                                        <option value="type">Type</option>
                                        <option value="safety">Safety</option>
                                    </select>
                                </div>
                            </div>
                            <div id="destinations" class="destinations-list">
                                <!-- Destinations will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Map Tab -->
                        <div id="map-tab" class="travel-tab-content">
                            <div class="map-controls-expanded">
                                <div class="map-info">
                                    <p><strong>Current Location:</strong> <span id="current-location-name">Unknown</span></p>
                                    <p><strong>Map Position:</strong> <span id="map-position">0, 0</span></p>
                                    <p><strong>Zoom:</strong> <span id="zoom-level">100%</span></p>
                                </div>
                                <div class="map-actions">
                                    <button id="center-on-player-btn">Center on Player</button>
                                    <button id="toggle-locations-btn">Toggle Locations</button>
                                    <button id="toggle-resources-btn">Toggle Resources</button>
                                    <button id="toggle-poi-btn">Toggle Points of Interest</button>
                                </div>
                            </div>
                            <div class="map-legend">
                                <h4>Map Legend</h4>
                                <div class="legend-items">
                                    <div class="legend-item">
                                        <span class="legend-color" style="background: #FF6B6B;"></span>
                                        <span>Cities</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background: #4ECDC4;"></span>
                                        <span>Towns</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background: #95E77E;"></span>
                                        <span>Villages</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-icon">üå≤</span>
                                        <span>Forests</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-icon">‚õèÔ∏è</span>
                                        <span>Mines</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-icon">üè†</span>
                                        <span>Inns</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-icon">üè™</span>
                                        <span>Trading Posts</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-icon">üõ°Ô∏è</span>
                                        <span>Guard Posts</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Resources Tab -->
                        <div id="resources-tab" class="travel-tab-content">
                            <div class="resource-controls">
                                <label for="resource-filter">Filter Resources:</label>
                                <select id="resource-filter">
                                    <option value="all">All Resources</option>
                                    <option value="forest">Forests</option>
                                    <option value="mine">Mines</option>
                                    <option value="herb">Herb Gardens</option>
                                </select>
                                <button id="refresh-resources-btn">Refresh Resources</button>
                            </div>
                            <div id="resource-nodes" class="resource-nodes-list">
                                <!-- Resource nodes will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- History Tab -->
                        <div id="history-tab" class="travel-tab-content">
                            <div class="history-controls">
                                <button id="clear-history-btn">Clear History</button>
                                <button id="export-history-btn">Export History</button>
                            </div>
                            <div id="travel-history" class="travel-history-list">
                                <!-- Travel history will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel-footer">
                        <button id="close-travel-btn">Close</button>
                    </div>
                </section>

                <!-- Transportation Panel -->
                <section id="transportation-panel" class="panel hidden">
                    <h2>Transportation</h2>
                    <div class="transportation-info">
                        <p>Current Transport: <span id="current-transport">Backpack</span></p>
                        <p>Carry Capacity: <span id="carry-capacity">50 lbs</span></p>
                        <p>Current Load: <span id="current-load">0 lbs</span></p>
                    </div>
                    <h3>Available Transportation</h3>
                    <div id="transportation-options" class="items-grid">
                        <!-- Transportation options will be populated by JavaScript -->
                    </div>
                    <div class="panel-footer">
                        <button id="close-transportation-btn">Close</button>
                    </div>
                </section>

                <!-- Property & Employee Management Panel -->
                <section id="property-employee-panel" class="panel hidden">
                    <div class="property-employee-header">
                        <h2>Property & Employee Management</h2>
                        <div class="financial-summary">
                            <span id="property-income">Property Income: 0 gold/day</span>
                            <span id="employee-costs">Employee Costs: 0 gold/week</span>
                            <span id="net-profit">Net Profit: 0 gold/day</span>
                        </div>
                    </div>
                    
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="properties">Properties</button>
                        <button class="tab-btn" data-tab="employees">Employees</button>
                        <button class="tab-btn" data-tab="trade-routes">Trade Routes</button>
                        <button class="tab-btn" data-tab="financial">Financial</button>
                    </div>
                    
                    <div id="property-employee-content">
                        <!-- Properties Tab -->
                        <div id="properties-tab" class="tab-content active">
                            <div class="properties-controls">
                                <button id="buy-property-btn">Buy Property</button>
                                <button id="property-upgrades-btn">Manage Upgrades</button>
                                <button id="repair-all-btn">Repair All</button>
                            </div>
                            <div id="owned-properties" class="properties-grid">
                                <!-- Owned properties will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Employees Tab -->
                        <div id="employees-tab" class="tab-content">
                            <div class="employees-controls">
                                <button id="hire-employee-btn">Hire Employee</button>
                                <button id="employee-training-btn">Training</button>
                                <button id="pay-wages-btn">Pay Wages</button>
                            </div>
                            <div id="hired-employees" class="employees-grid">
                                <!-- Hired employees will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Trade Routes Tab -->
                        <div id="trade-routes-tab" class="tab-content">
                            <div class="trade-routes-controls">
                                <button id="create-route-btn">Create Route</button>
                                <button id="optimize-routes-btn">Optimize Routes</button>
                                <button id="route-history-btn">Route History</button>
                            </div>
                            <div id="active-routes" class="routes-grid">
                                <!-- Active trade routes will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Financial Tab -->
                        <div id="financial-tab" class="tab-content">
                            <div class="financial-overview">
                                <h3>Financial Overview</h3>
                                <div class="financial-stats">
                                    <div class="stat-item">
                                        <span class="stat-label">Daily Income:</span>
                                        <span id="daily-income" class="stat-value">0 gold</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Weekly Expenses:</span>
                                        <span id="weekly-expenses" class="stat-value">0 gold</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Property Value:</span>
                                        <span id="property-value" class="stat-value">0 gold</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Total Assets:</span>
                                        <span id="total-assets" class="stat-value">0 gold</span>
                                    </div>
                                </div>
                            </div>
                            <div class="financial-history">
                                <h3>Transaction History</h3>
                                <div id="transaction-history" class="transaction-list">
                                    <!-- Transaction history will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel-footer">
                        <button id="close-property-employee-btn">Close</button>
                    </div>
                </section>

                <!-- Property Details Modal -->
                <div id="property-details-modal" class="modal hidden">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 id="property-details-name">Property Name</h3>
                            <button id="close-property-details" class="close-btn">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="property-info">
                                <div class="property-icon" id="property-details-icon">üè†</div>
                                <div class="property-stats">
                                    <div class="property-stat">
                                        <span class="stat-label">Type:</span>
                                        <span id="property-details-type">House</span>
                                    </div>
                                    <div class="property-stat">
                                        <span class="stat-label">Location:</span>
                                        <span id="property-details-location">Town</span>
                                    </div>
                                    <div class="property-stat">
                                        <span class="stat-label">Level:</span>
                                        <span id="property-details-level">1</span>
                                    </div>
                                    <div class="property-stat">
                                        <span class="stat-label">Condition:</span>
                                        <span id="property-details-condition">100%</span>
                                    </div>
                                    <div class="property-stat">
                                        <span class="stat-label">Income:</span>
                                        <span id="property-details-income">10 gold/day</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="property-upgrades">
                                <h4>Available Upgrades</h4>
                                <div id="property-upgrades-list" class="upgrades-list">
                                    <!-- Upgrades will be populated by JavaScript -->
                                </div>
                            </div>
                            
                            <div class="property-employees">
                                <h4>Assigned Employees</h4>
                                <div id="property-employees-list" class="employees-list">
                                    <!-- Assigned employees will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button id="repair-property-btn" class="action-btn">Repair</button>
                            <button id="upgrade-property-btn" class="action-btn">Upgrade</button>
                            <button id="sell-property-btn" class="action-btn danger">Sell</button>
                        </div>
                    </div>
                </div>

                <!-- Employee Details Modal -->
                <div id="employee-details-modal" class="modal hidden">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 id="employee-details-name">Employee Name</h3>
                            <button id="close-employee-details" class="close-btn">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="employee-info">
                                <div class="employee-avatar" id="employee-details-avatar">üë§</div>
                                <div class="employee-stats">
                                    <div class="employee-stat">
                                        <span class="stat-label">Type:</span>
                                        <span id="employee-details-type">Merchant</span>
                                    </div>
                                    <div class="employee-stat">
                                        <span class="stat-label">Level:</span>
                                        <span id="employee-details-level">1</span>
                                    </div>
                                    <div class="employee-stat">
                                        <span class="stat-label">Experience:</span>
                                        <span id="employee-details-experience">0/100</span>
                                    </div>
                                    <div class="employee-stat">
                                        <span class="stat-label">Morale:</span>
                                        <span id="employee-details-morale">Normal</span>
                                    </div>
                                    <div class="employee-stat">
                                        <span class="stat-label">Wage:</span>
                                        <span id="employee-details-wage">5 gold/week</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="employee-skills">
                                <h4>Skills</h4>
                                <div id="employee-skills-list" class="skills-list">
                                    <!-- Skills will be populated by JavaScript -->
                                </div>
                            </div>
                            
                            <div class="employee-assignment">
                                <h4>Current Assignment</h4>
                                <div id="employee-assignment-info" class="assignment-info">
                                    <!-- Assignment info will be populated by JavaScript -->
                                </div>
                                <div class="assignment-controls">
                                    <select id="assignment-property-select">
                                        <option value="">Select Property</option>
                                    </select>
                                    <button id="assign-employee-btn">Assign</button>
                                    <button id="unassign-employee-btn">Unassign</button>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button id="train-employee-btn" class="action-btn">Train</button>
                            <button id="promote-employee-btn" class="action-btn">Promote</button>
                            <button id="fire-employee-btn" class="action-btn danger">Fire</button>
                        </div>
                    </div>
                </div>

                <!-- Message Log -->
                <section id="message-log">
                    <h3>Messages</h3>
                    <div id="messages" aria-live="polite">
                        <p class="message">Welcome to the Trading Game!</p>
                    </div>
                </section>
                <section id="insights-panel" class="panel compact">
                    <div class="insights-grid">
                        <div class="insight-card" aria-live="polite">
                            <div class="insight-header">
                                <h4>Game Statistics</h4>
                                <span class="insight-subtitle">Live progress tracker</span>
                            </div>
                            <dl id="game-stats-list" class="insight-list">
                                <div class="insight-row">
                                    <dt>Gold on hand</dt>
                                    <dd id="stat-gold">0</dd>
                                </div>
                                <div class="insight-row">
                                    <dt>Days survived</dt>
                                    <dd id="stat-days">0</dd>
                                </div>
                                <div class="insight-row">
                                    <dt>Properties owned</dt>
                                    <dd id="stat-properties">0</dd>
                                </div>
                                <div class="insight-row">
                                    <dt>Employees hired</dt>
                                    <dd id="stat-employees">0</dd>
                                </div>
                                <div class="insight-row">
                                    <dt>Locations visited</dt>
                                    <dd id="stat-locations">0</dd>
                                </div>
                            </dl>
                        </div>
                        <div class="insight-card" aria-live="polite">
                            <div class="insight-header">
                                <h4>Achievements</h4>
                                <span class="insight-subtitle">Complete milestones to earn rewards</span>
                            </div>
                            <div id="achievement-list" class="achievement-list">
                                <!-- Achievements populated by JavaScript -->
                            </div>
                        </div>
                        <div class="insight-card" aria-live="polite">
                            <div class="insight-header">
                                <h4>Quick Navigation</h4>
                                <span class="insight-subtitle">Jump between nearby hubs</span>
                            </div>
                            <div id="quick-navigation" class="quick-navigation">
                                <div class="minimap" aria-hidden="true">
                                    <div class="minimap-overlay">
                                        <span class="minimap-dot" title="Current position"></span>
                                        <span class="minimap-ring"></span>
                                    </div>
                                </div>
                                <div class="navigation-details">
                                    <p class="nav-location">Current: <span id="nav-current-location">Unknown</span></p>
                                    <div id="nav-connections" class="nav-connections" role="list">
                                        <p class="nav-hint">Connections will appear once you start traveling.</p>
                                    </div>
                                    <button id="open-travel-from-nav" class="secondary">Open Travel Planner</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Game Controls -->
        <footer id="game-controls">
            <div class="control-group">
                <button id="menu-btn">üìú Menu</button>
                <button id="inventory-btn">üéí Inventory</button>
                <button id="property-employee-btn">üè† Properties</button>
                <button id="transportation-quick-btn">üöö Transport</button>
                <button id="save-btn">üíæ Save</button>
                <button id="load-btn">üìÇ Load</button>
            </div>
            <div class="time-controls">
                <button id="pause-btn" class="time-control-btn">‚è∏Ô∏è Pause</button>
                <button id="normal-speed-btn" class="time-control-btn active">‚è±Ô∏è Normal</button>
                <button id="fast-speed-btn" class="time-control-btn">‚è© Fast</button>
                <button id="very-fast-speed-btn" class="time-control-btn">‚è≠Ô∏è Very Fast</button>
            </div>
        </footer>
    </div>

    <div id="controls-help-overlay" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="controls-help-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="controls-help-title">Controls & Shortcuts</h2>
                <button id="close-controls-help" class="close-btn" aria-label="Close controls help">√ó</button>
            </div>
            <div class="modal-body">
                <p class="modal-lead">Use these shortcuts and quick actions to stay efficient. Tooltips on every button remind you what they do.</p>
                <div class="controls-help-grid">
                    <div class="controls-section">
                        <h3>Core Shortcuts</h3>
                        <ul class="shortcut-list">
                            <li><strong>Ctrl + S</strong> ‚Äî Quick Save anywhere</li>
                            <li><strong>Ctrl + L</strong> ‚Äî Quick Load (confirms during play)</li>
                            <li><strong>Shift + /</strong> ‚Äî Toggle this help overlay</li>
                            <li><strong>Esc</strong> ‚Äî Toggle menu / close panels</li>
                            <li><strong>1-7 in Market</strong> ‚Äî Jump between tabs</li>
                        </ul>
                    </div>
                    <div class="controls-section">
                        <h3>Panel Navigation</h3>
                        <ul class="shortcut-list">
                            <li><strong>I</strong> ‚Äî Inventory</li>
                            <li><strong>M</strong> ‚Äî Market</li>
                            <li><strong>T</strong> ‚Äî Transportation</li>
                            <li><strong>B</strong> ‚Äî Bulk trade toggle</li>
                            <li><strong>Tab</strong> ‚Äî Move between inputs/buttons</li>
                        </ul>
                    </div>
                    <div class="controls-section">
                        <h3>Starter Play Guide</h3>
                        <ol class="tutorial-steps">
                            <li>Open <strong>üéÆ New Game</strong> and pick a difficulty that matches your experience.</li>
                            <li>Choose perks, then press <strong>Start Adventure</strong> to enter the world.</li>
                            <li>Use <strong>M</strong> to visit the market and buy low; check <strong>History</strong> for trends.</li>
                            <li>Travel with <strong>T</strong> when prices stagnate; time controls in the footer adjust pace.</li>
                            <li>Quick Save before risky trades or travel, and Quick Load if you need to rewind.</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="onboarding-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="onboarding-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="onboarding-title">Welcome to Trading Game</h2>
                <button id="skip-onboarding-btn" class="close-btn" aria-label="Close onboarding">√ó</button>
            </div>
            <div class="modal-body onboarding-body">
                <p class="modal-lead">Follow these quick steps to get comfortable. You can replay this tour anytime.</p>
                <div class="onboarding-stepper" role="list" aria-live="polite">
                    <div class="onboarding-step" data-step="0" role="listitem">
                        <h3>1. Create your trader</h3>
                        <p>Choose a name, difficulty, and perks. Watch the preview to see starting gold and attributes update.</p>
                    </div>
                    <div class="onboarding-step" data-step="1" role="listitem">
                        <h3>2. Learn the panels</h3>
                        <p>Use <strong>M</strong> for Market, <strong>I</strong> for Inventory, and <strong>T</strong> for Transportation. Tabs are keyboard-accessible.</p>
                    </div>
                    <div class="onboarding-step" data-step="2" role="listitem">
                        <h3>3. Trade and travel smart</h3>
                        <p>Check History and Alerts, set routes, and travel when prices stagnate. Quick save before risky trips.</p>
                    </div>
                </div>
                <div class="onboarding-progress" role="progressbar" aria-valuemin="1" aria-valuemax="3" aria-valuenow="1">
                    <div class="onboarding-progress-fill"></div>
                </div>
            </div>
            <div class="modal-footer onboarding-actions">
                <button id="onboarding-prev-btn" class="secondary" aria-label="Previous step">Previous</button>
                <button id="onboarding-next-btn" aria-label="Next step">Next</button>
                <button id="onboarding-done-btn" class="primary">Got it</button>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="settings-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="settings-title">Settings</h2>
                <button id="close-settings-btn" class="close-btn" aria-label="Close settings">√ó</button>
            </div>
            <div class="modal-body settings-body">
                <div class="settings-tabs" role="tablist">
                    <button class="settings-tab active" data-settings-tab="accessibility" role="tab">Accessibility</button>
                    <button class="settings-tab" data-settings-tab="audio" role="tab">Audio</button>
                    <button class="settings-tab" data-settings-tab="visual" role="tab">Visual</button>
                    <button class="settings-tab" data-settings-tab="controls" role="tab">Controls</button>
                </div>

                <section class="settings-section settings-tab-content active" id="settings-accessibility" role="tabpanel">
                    <h3>Accessibility</h3>
                    <label class="toggle">
                        <input type="checkbox" id="high-contrast-toggle">
                        <span>High contrast mode</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="colorblind-toggle">
                        <span>Colorblind-friendly palette</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="keyboard-nav-toggle" checked>
                        <span>Enhanced keyboard navigation</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="reduced-motion-toggle">
                        <span>Reduce motion & flashes</span>
                    </label>
                    <div class="setting-control">
                        <label for="font-size-range">Font size</label>
                        <input type="range" id="font-size-range" min="90" max="120" step="5" value="100">
                        <div class="setting-hint" id="font-size-label">100%</div>
                    </div>
                </section>

                <section class="settings-section settings-tab-content" id="settings-audio" role="tabpanel">
                    <h3>Audio & Atmosphere</h3>
                    <p class="setting-hint">Changes apply instantly and save to your browser.</p>
                    <div class="setting-control slider-control">
                        <div class="setting-label">
                            <span>Master Volume</span>
                            <span id="master-volume-label" class="setting-value">80%</span>
                        </div>
                        <input type="range" id="master-volume-range" min="0" max="100" step="5" value="80">
                    </div>
                    <div class="setting-control slider-control">
                        <div class="setting-label">
                            <span>Music</span>
                            <span id="music-volume-label" class="setting-value">60%</span>
                        </div>
                        <input type="range" id="music-volume-range" min="0" max="100" step="5" value="60">
                    </div>
                    <div class="setting-control slider-control">
                        <div class="setting-label">
                            <span>Sound Effects</span>
                            <span id="sfx-volume-label" class="setting-value">75%</span>
                        </div>
                        <input type="range" id="sfx-volume-range" min="0" max="100" step="5" value="75">
                    </div>
                    <div class="setting-control slider-control">
                        <div class="setting-label">
                            <span>Ambient</span>
                            <span id="ambient-volume-label" class="setting-value">50%</span>
                        </div>
                        <input type="range" id="ambient-volume-range" min="0" max="100" step="5" value="50">
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="mute-toggle">
                        <span>Mute all audio</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="music-mute-toggle">
                        <span>Mute music</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="sfx-mute-toggle">
                        <span>Mute sound effects</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="ambient-toggle" checked>
                        <span>Enable ambient soundscapes</span>
                    </label>
                </section>

                <section class="settings-section settings-tab-content" id="settings-visual" role="tabpanel">
                    <h3>Visual</h3>
                    <div class="setting-control">
                        <label for="vfx-quality-select">Graphics Quality</label>
                        <select id="vfx-quality-select">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high" selected>High</option>
                        </select>
                    </div>
                    <div class="setting-control slider-control">
                        <div class="setting-label">
                            <span>Particle Density</span>
                            <span id="particle-density-label" class="setting-value">100%</span>
                        </div>
                        <input type="range" id="particle-density-range" min="25" max="150" step="5" value="100">
                    </div>
                    <div class="setting-control slider-control">
                        <div class="setting-label">
                            <span>Screen Shake</span>
                            <span id="screen-shake-label" class="setting-value">70%</span>
                        </div>
                        <input type="range" id="screen-shake-range" min="0" max="100" step="5" value="70">
                    </div>
                    <div class="setting-control slider-control">
                        <div class="setting-label">
                            <span>Animation Speed</span>
                            <span id="animation-speed-label" class="setting-value">100%</span>
                        </div>
                        <input type="range" id="animation-speed-range" min="70" max="130" step="5" value="100">
                    </div>
                    <div class="setting-control">
                        <label for="environment-quality-select">Environment Fidelity</label>
                        <select id="environment-quality-select">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high" selected>High</option>
                        </select>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="performance-overlay-toggle">
                        <span>Show performance overlay</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="auto-quality-toggle" checked>
                        <span>Auto-adjust quality to protect FPS</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="flash-warning-toggle">
                        <span>Soften flashes and screen shake</span>
                    </label>
                </section>

                <section class="settings-section settings-tab-content" id="settings-controls" role="tabpanel">
                    <h3>Controls</h3>
                    <p class="setting-hint">Click a binding, then press the new key or combo. Escape cancels.</p>
                    <div class="control-binding-grid">
                        <label class="control-binding">
                            <span>Open Inventory</span>
                            <input type="text" class="control-binding-input" data-action="openInventory" aria-label="Inventory key" readonly>
                        </label>
                        <label class="control-binding">
                            <span>Open Market</span>
                            <input type="text" class="control-binding-input" data-action="openMarket" aria-label="Market key" readonly>
                        </label>
                        <label class="control-binding">
                            <span>Transportation</span>
                            <input type="text" class="control-binding-input" data-action="openTransportation" aria-label="Transportation key" readonly>
                        </label>
                        <label class="control-binding">
                            <span>Toggle Menu</span>
                            <input type="text" class="control-binding-input" data-action="toggleMenu" aria-label="Menu key" readonly>
                        </label>
                        <label class="control-binding">
                            <span>Quick Save</span>
                            <input type="text" class="control-binding-input" data-action="quickSave" aria-label="Quick save key" readonly>
                        </label>
                        <label class="control-binding">
                            <span>Quick Load</span>
                            <input type="text" class="control-binding-input" data-action="quickLoad" aria-label="Quick load key" readonly>
                        </label>
                        <label class="control-binding">
                            <span>Controls Help</span>
                            <input type="text" class="control-binding-input" data-action="controlsHelp" aria-label="Controls help key" readonly>
                        </label>
                        <label class="control-binding">
                            <span>Undo</span>
                            <input type="text" class="control-binding-input" data-action="undoAction" aria-label="Undo key" readonly>
                        </label>
                        <label class="control-binding">
                            <span>Redo</span>
                            <input type="text" class="control-binding-input" data-action="redoAction" aria-label="Redo key" readonly>
                        </label>
                    </div>
                    <div class="control-binding-actions">
                        <button id="reset-bindings-btn" class="secondary">Reset Bindings</button>
                        <span id="binding-hint" class="setting-hint" aria-live="polite">Select a binding to change it.</span>
                    </div>
                </section>
            </div>
            <div class="modal-footer settings-actions">
                <button id="reset-settings-btn" class="secondary">Reset to Default</button>
                <button id="save-settings-btn" class="primary">Save & Close</button>
            </div>
        </div>
    </div>

    <div id="live-region" class="sr-only" aria-live="polite"></div>

    <div id="performance-overlay" class="performance-overlay hidden" aria-live="polite">
        <div class="perf-row"><span>FPS</span><strong id="perf-fps">60</strong></div>
        <div class="perf-row"><span>Frame Time</span><strong id="perf-frame">16 ms</strong></div>
        <div class="perf-row"><span>Quality</span><strong id="perf-quality">High ‚Ä¢ 100%</strong></div>
        <div class="perf-row"><span>Memory</span><strong id="perf-memory">‚Äî</strong></div>
    </div>

    <div id="atmosphere-layer" aria-hidden="true"></div>
    <div id="environment-overlay" aria-hidden="true"></div>
    <div id="highlight-layer" aria-hidden="true"></div>
    <div id="particle-layer" aria-hidden="true"></div>

    <div id="screen-fader" aria-hidden="true"></div>

    <div id="notification-tray" aria-live="polite" role="status"></div>

    <div id="controls-help-overlay" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="controls-help-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="controls-help-title">Controls & Shortcuts</h2>
                <button id="close-controls-help" class="close-btn" aria-label="Close controls help">√ó</button>
            </div>
            <div class="modal-body">
                <p>Use these shortcuts for faster navigation:</p>
                <ul>
                    <li><strong>Ctrl + S</strong>: Quick Save</li>
                    <li><strong>Ctrl + L</strong>: Quick Load (asks for confirmation during play)</li>
                    <li><strong>I</strong>: Open Inventory</li>
                    <li><strong>M</strong>: Open Market</li>
                    <li><strong>T</strong>: Open Transportation</li>
                    <li><strong>Escape</strong>: Toggle menu or return to game</li>
                    <li><strong>1-7 (in Market)</strong>: Switch between market tabs</li>
                    <li><strong>Shift + /</strong>: Toggle this help panel</li>
                </ul>
                <p>Use button tooltips to learn what each action does.</p>
            </div>
        </div>
    </div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="screen">
        <div class="loading-content">
            <h2>Loading Trading Game...</h2>
            <p id="loading-message" class="loading-message">Preparing your journey</p>
            <div class="progress-bar">
                <div id="loading-progress-fill" class="progress-fill"></div>
            </div>
        </div>
    </div>

    <!-- Main Menu -->
    <div id="main-menu" class="screen">
        <div class="menu-content">
            <h1>Trading Game</h1>
            <div class="menu-buttons">
                <button id="new-game-btn">üéÆ New Game</button>
                <button id="load-game-btn" disabled>üìÇ Load Game</button>
                <button id="settings-btn">‚öôÔ∏è Settings</button>
            </div>
        </div>
    </div>

    <script src="audio-system.js"></script>
    <script src="property-system.js"></script>
    <script src="employee-system.js"></script>
    <script src="trade-route-system.js"></script>
    <script src="property-employee-ui.js"></script>
    <script src="travel-system.js"></script>
    <script src="game.js"></script>
</body>
</html>