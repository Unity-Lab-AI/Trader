# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ–¤ GITHUB PAGES DEPLOYMENT + PLAYWRIGHT TESTS WITH VISUAL STATUS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Flow:
#   1. Build and deploy to GitHub Pages
#   2. Run Playwright tests against the deployed site
#   3. Visual test status with individual workflow lights per test suite
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

name: Deploy and Test

on:
  push:
    branches:
      - main
      - master

  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ“¦ BUILD JOB - Prepare the static site
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  build:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ğŸ“„ Setup Pages
        uses: actions/configure-pages@v4

      - name: ğŸ“¤ Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸš€ DEPLOY JOB - Push to GitHub Pages
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    outputs:
      page_url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: ğŸš€ Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ§ª TEST SETUP - Install dependencies and prepare
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-setup:
    runs-on: ubuntu-latest
    needs: deploy
    outputs:
      page_url: ${{ needs.deploy.outputs.page_url }}
    steps:
      - name: ğŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“¥ Install dependencies
        run: npm ci

      - name: ğŸ­ Install Playwright browsers
        run: npx playwright install --with-deps chromium

      - name: ğŸ“¤ Cache Playwright
        uses: actions/cache/save@v4
        with:
          path: |
            ~/.cache/ms-playwright
            node_modules
          key: playwright-${{ runner.os }}-${{ hashFiles('package-lock.json') }}

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ® TEST: New Game Flow
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-new-game:
    runs-on: ubuntu-latest
    needs: [deploy, test-setup]
    steps:
      - name: ğŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“¥ Restore cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/.cache/ms-playwright
            node_modules
          key: playwright-${{ runner.os }}-${{ hashFiles('package-lock.json') }}

      - name: ğŸ”§ Install if cache miss
        run: |
          if [ ! -d "node_modules" ]; then npm ci; fi
          if [ ! -d "$HOME/.cache/ms-playwright" ]; then npx playwright install --with-deps chromium; fi

      - name: ğŸŸ¡ Starting New Game Tests
        run: echo "::notice title=ğŸ® New Game Tests::Starting test suite..."

      - name: ğŸ§ª Run New Game Tests
        id: test
        env:
          BASE_URL: ${{ needs.deploy.outputs.page_url }}
        run: |
          echo "ğŸ® Testing: new-game.spec.js"
          npx playwright test tests/new-game.spec.js --reporter=json --reporter=line 2>&1 | tee results.txt

          PASSED=$(grep -oP '\d+(?= passed)' results.txt | head -1 || echo "0")
          FAILED=$(grep -oP '\d+(?= failed)' results.txt | head -1 || echo "0")
          echo "passed=$PASSED" >> $GITHUB_OUTPUT
          echo "failed=$FAILED" >> $GITHUB_OUTPUT

      - name: ğŸŸ¢ New Game Tests Complete
        if: success()
        run: |
          echo "::notice title=ğŸ® New Game Tests::âœ… All tests passed!"
          echo "## ğŸ® New Game Tests: âœ… PASSED" >> $GITHUB_STEP_SUMMARY

      - name: ğŸ”´ New Game Tests Failed
        if: failure()
        run: |
          echo "::error title=ğŸ® New Game Tests::âŒ Some tests failed!"
          echo "## ğŸ® New Game Tests: âŒ FAILED" >> $GITHUB_STEP_SUMMARY

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ› TEST: Debug Commands
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-debug-commands:
    runs-on: ubuntu-latest
    needs: [deploy, test-setup]
    steps:
      - name: ğŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“¥ Restore cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/.cache/ms-playwright
            node_modules
          key: playwright-${{ runner.os }}-${{ hashFiles('package-lock.json') }}

      - name: ğŸ”§ Install if cache miss
        run: |
          if [ ! -d "node_modules" ]; then npm ci; fi
          if [ ! -d "$HOME/.cache/ms-playwright" ]; then npx playwright install --with-deps chromium; fi

      - name: ğŸŸ¡ Starting Debug Command Tests
        run: echo "::notice title=ğŸ› Debug Commands::Starting test suite..."

      - name: ğŸ§ª Run Debug Command Tests
        id: test
        env:
          BASE_URL: ${{ needs.deploy.outputs.page_url }}
        run: |
          echo "ğŸ› Testing: debug-commands.spec.js"
          npx playwright test tests/debug-commands.spec.js --reporter=json --reporter=line 2>&1 | tee results.txt

          PASSED=$(grep -oP '\d+(?= passed)' results.txt | head -1 || echo "0")
          FAILED=$(grep -oP '\d+(?= failed)' results.txt | head -1 || echo "0")
          echo "passed=$PASSED" >> $GITHUB_OUTPUT
          echo "failed=$FAILED" >> $GITHUB_OUTPUT

      - name: ğŸŸ¢ Debug Command Tests Complete
        if: success()
        run: |
          echo "::notice title=ğŸ› Debug Commands::âœ… All tests passed!"
          echo "## ğŸ› Debug Commands: âœ… PASSED" >> $GITHUB_STEP_SUMMARY

      - name: ğŸ”´ Debug Command Tests Failed
        if: failure()
        run: |
          echo "::error title=ğŸ› Debug Commands::âŒ Some tests failed!"
          echo "## ğŸ› Debug Commands: âŒ FAILED" >> $GITHUB_STEP_SUMMARY

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ“‹ TEST: Panel Tests
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-panels:
    runs-on: ubuntu-latest
    needs: [deploy, test-setup]
    steps:
      - name: ğŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“¥ Restore cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/.cache/ms-playwright
            node_modules
          key: playwright-${{ runner.os }}-${{ hashFiles('package-lock.json') }}

      - name: ğŸ”§ Install if cache miss
        run: |
          if [ ! -d "node_modules" ]; then npm ci; fi
          if [ ! -d "$HOME/.cache/ms-playwright" ]; then npx playwright install --with-deps chromium; fi

      - name: ğŸŸ¡ Starting Panel Tests
        run: echo "::notice title=ğŸ“‹ Panel Tests::Starting test suite..."

      - name: ğŸ§ª Run Panel Tests
        id: test
        env:
          BASE_URL: ${{ needs.deploy.outputs.page_url }}
        run: |
          echo "ğŸ“‹ Testing: panels.spec.js"
          npx playwright test tests/panels.spec.js --reporter=json --reporter=line 2>&1 | tee results.txt

          PASSED=$(grep -oP '\d+(?= passed)' results.txt | head -1 || echo "0")
          FAILED=$(grep -oP '\d+(?= failed)' results.txt | head -1 || echo "0")
          echo "passed=$PASSED" >> $GITHUB_OUTPUT
          echo "failed=$FAILED" >> $GITHUB_OUTPUT

      - name: ğŸŸ¢ Panel Tests Complete
        if: success()
        run: |
          echo "::notice title=ğŸ“‹ Panel Tests::âœ… All tests passed!"
          echo "## ğŸ“‹ Panel Tests: âœ… PASSED" >> $GITHUB_STEP_SUMMARY

      - name: ğŸ”´ Panel Tests Failed
        if: failure()
        run: |
          echo "::error title=ğŸ“‹ Panel Tests::âŒ Some tests failed!"
          echo "## ğŸ“‹ Panel Tests: âŒ FAILED" >> $GITHUB_STEP_SUMMARY

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ¯ TEST: Features
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-features:
    runs-on: ubuntu-latest
    needs: [deploy, test-setup]
    steps:
      - name: ğŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“¥ Restore cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/.cache/ms-playwright
            node_modules
          key: playwright-${{ runner.os }}-${{ hashFiles('package-lock.json') }}

      - name: ğŸ”§ Install if cache miss
        run: |
          if [ ! -d "node_modules" ]; then npm ci; fi
          if [ ! -d "$HOME/.cache/ms-playwright" ]; then npx playwright install --with-deps chromium; fi

      - name: ğŸŸ¡ Starting Feature Tests
        run: echo "::notice title=ğŸ¯ Features::Starting test suite..."

      - name: ğŸ§ª Run Feature Tests
        id: test
        env:
          BASE_URL: ${{ needs.deploy.outputs.page_url }}
        run: |
          echo "ğŸ¯ Testing: features.spec.js"
          npx playwright test tests/features.spec.js --reporter=json --reporter=line 2>&1 | tee results.txt

          PASSED=$(grep -oP '\d+(?= passed)' results.txt | head -1 || echo "0")
          FAILED=$(grep -oP '\d+(?= failed)' results.txt | head -1 || echo "0")
          echo "passed=$PASSED" >> $GITHUB_OUTPUT
          echo "failed=$FAILED" >> $GITHUB_OUTPUT

      - name: ğŸŸ¢ Feature Tests Complete
        if: success()
        run: |
          echo "::notice title=ğŸ¯ Features::âœ… All tests passed!"
          echo "## ğŸ¯ Feature Tests: âœ… PASSED" >> $GITHUB_STEP_SUMMARY

      - name: ğŸ”´ Feature Tests Failed
        if: failure()
        run: |
          echo "::error title=ğŸ¯ Features::âŒ Some tests failed!"
          echo "## ğŸ¯ Feature Tests: âŒ FAILED" >> $GITHUB_STEP_SUMMARY

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # âš™ï¸ TEST: Settings
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-settings:
    runs-on: ubuntu-latest
    needs: [deploy, test-setup]
    steps:
      - name: ğŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“¥ Restore cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/.cache/ms-playwright
            node_modules
          key: playwright-${{ runner.os }}-${{ hashFiles('package-lock.json') }}

      - name: ğŸ”§ Install if cache miss
        run: |
          if [ ! -d "node_modules" ]; then npm ci; fi
          if [ ! -d "$HOME/.cache/ms-playwright" ]; then npx playwright install --with-deps chromium; fi

      - name: ğŸŸ¡ Starting Settings Tests
        run: echo "::notice title=âš™ï¸ Settings::Starting test suite..."

      - name: ğŸ§ª Run Settings Tests
        id: test
        env:
          BASE_URL: ${{ needs.deploy.outputs.page_url }}
        run: |
          echo "âš™ï¸ Testing: settings.spec.js"
          npx playwright test tests/settings.spec.js --reporter=json --reporter=line 2>&1 | tee results.txt

          PASSED=$(grep -oP '\d+(?= passed)' results.txt | head -1 || echo "0")
          FAILED=$(grep -oP '\d+(?= failed)' results.txt | head -1 || echo "0")
          echo "passed=$PASSED" >> $GITHUB_OUTPUT
          echo "failed=$FAILED" >> $GITHUB_OUTPUT

      - name: ğŸŸ¢ Settings Tests Complete
        if: success()
        run: |
          echo "::notice title=âš™ï¸ Settings::âœ… All tests passed!"
          echo "## âš™ï¸ Settings Tests: âœ… PASSED" >> $GITHUB_STEP_SUMMARY

      - name: ğŸ”´ Settings Tests Failed
        if: failure()
        run: |
          echo "::error title=âš™ï¸ Settings::âŒ Some tests failed!"
          echo "## âš™ï¸ Settings Tests: âŒ FAILED" >> $GITHUB_STEP_SUMMARY

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ–¥ï¸ TEST: UI Elements
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-ui-elements:
    runs-on: ubuntu-latest
    needs: [deploy, test-setup]
    steps:
      - name: ğŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“¥ Restore cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/.cache/ms-playwright
            node_modules
          key: playwright-${{ runner.os }}-${{ hashFiles('package-lock.json') }}

      - name: ğŸ”§ Install if cache miss
        run: |
          if [ ! -d "node_modules" ]; then npm ci; fi
          if [ ! -d "$HOME/.cache/ms-playwright" ]; then npx playwright install --with-deps chromium; fi

      - name: ğŸŸ¡ Starting UI Element Tests
        run: echo "::notice title=ğŸ–¥ï¸ UI Elements::Starting test suite..."

      - name: ğŸ§ª Run UI Element Tests
        id: test
        env:
          BASE_URL: ${{ needs.deploy.outputs.page_url }}
        run: |
          echo "ğŸ–¥ï¸ Testing: ui-elements.spec.js"
          npx playwright test tests/ui-elements.spec.js --reporter=json --reporter=line 2>&1 | tee results.txt

          PASSED=$(grep -oP '\d+(?= passed)' results.txt | head -1 || echo "0")
          FAILED=$(grep -oP '\d+(?= failed)' results.txt | head -1 || echo "0")
          echo "passed=$PASSED" >> $GITHUB_OUTPUT
          echo "failed=$FAILED" >> $GITHUB_OUTPUT

      - name: ğŸŸ¢ UI Element Tests Complete
        if: success()
        run: |
          echo "::notice title=ğŸ–¥ï¸ UI Elements::âœ… All tests passed!"
          echo "## ğŸ–¥ï¸ UI Element Tests: âœ… PASSED" >> $GITHUB_STEP_SUMMARY

      - name: ğŸ”´ UI Element Tests Failed
        if: failure()
        run: |
          echo "::error title=ğŸ–¥ï¸ UI Elements::âŒ Some tests failed!"
          echo "## ğŸ–¥ï¸ UI Element Tests: âŒ FAILED" >> $GITHUB_STEP_SUMMARY

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ¨ TEST: Comprehensive UI
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-comprehensive-ui:
    runs-on: ubuntu-latest
    needs: [deploy, test-setup]
    steps:
      - name: ğŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“¥ Restore cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/.cache/ms-playwright
            node_modules
          key: playwright-${{ runner.os }}-${{ hashFiles('package-lock.json') }}

      - name: ğŸ”§ Install if cache miss
        run: |
          if [ ! -d "node_modules" ]; then npm ci; fi
          if [ ! -d "$HOME/.cache/ms-playwright" ]; then npx playwright install --with-deps chromium; fi

      - name: ğŸŸ¡ Starting Comprehensive UI Tests
        run: echo "::notice title=ğŸ¨ Comprehensive UI::Starting test suite..."

      - name: ğŸ§ª Run Comprehensive UI Tests
        id: test
        env:
          BASE_URL: ${{ needs.deploy.outputs.page_url }}
        run: |
          echo "ğŸ¨ Testing: comprehensive-ui.spec.js"
          npx playwright test tests/comprehensive-ui.spec.js --reporter=json --reporter=line 2>&1 | tee results.txt

          PASSED=$(grep -oP '\d+(?= passed)' results.txt | head -1 || echo "0")
          FAILED=$(grep -oP '\d+(?= failed)' results.txt | head -1 || echo "0")
          echo "passed=$PASSED" >> $GITHUB_OUTPUT
          echo "failed=$FAILED" >> $GITHUB_OUTPUT

      - name: ğŸŸ¢ Comprehensive UI Tests Complete
        if: success()
        run: |
          echo "::notice title=ğŸ¨ Comprehensive UI::âœ… All tests passed!"
          echo "## ğŸ¨ Comprehensive UI Tests: âœ… PASSED" >> $GITHUB_STEP_SUMMARY

      - name: ğŸ”´ Comprehensive UI Tests Failed
        if: failure()
        run: |
          echo "::error title=ğŸ¨ Comprehensive UI::âŒ Some tests failed!"
          echo "## ğŸ¨ Comprehensive UI Tests: âŒ FAILED" >> $GITHUB_STEP_SUMMARY

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ“Š FINAL SUMMARY - Aggregate all test results
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test-summary:
    runs-on: ubuntu-latest
    needs: [deploy, test-new-game, test-debug-commands, test-panels, test-features, test-settings, test-ui-elements, test-comprehensive-ui]
    if: always()
    steps:
      - name: ğŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ğŸ“Š Generate Visual Test Summary
        env:
          DEPLOY_URL: ${{ needs.deploy.outputs.page_url }}
          NEW_GAME: ${{ needs.test-new-game.result }}
          DEBUG_CMDS: ${{ needs.test-debug-commands.result }}
          PANELS: ${{ needs.test-panels.result }}
          FEATURES: ${{ needs.test-features.result }}
          SETTINGS: ${{ needs.test-settings.result }}
          UI_ELEMENTS: ${{ needs.test-ui-elements.result }}
          COMPREHENSIVE: ${{ needs.test-comprehensive-ui.result }}
        run: |
          # Simple status indicator function
          status_icon() {
            if [ "$1" = "success" ]; then echo "âœ…"; else echo "âŒ"; fi
          }

          # Count results
          SUCCESS_COUNT=0
          FAILURE_COUNT=0
          for result in "$NEW_GAME" "$DEBUG_CMDS" "$PANELS" "$FEATURES" "$SETTINGS" "$UI_ELEMENTS" "$COMPREHENSIVE"; do
            if [ "$result" = "success" ]; then SUCCESS_COUNT=$((SUCCESS_COUNT + 1)); fi
            if [ "$result" = "failure" ]; then FAILURE_COUNT=$((FAILURE_COUNT + 1)); fi
          done

          # Generate summary
          echo "# Medieval Trading Game - Test Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Deployed to:** $DEPLOY_URL" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## Test Suites" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Suite | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|-------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| New Game Flow | $(status_icon $NEW_GAME) $NEW_GAME |" >> $GITHUB_STEP_SUMMARY
          echo "| Debug Commands | $(status_icon $DEBUG_CMDS) $DEBUG_CMDS |" >> $GITHUB_STEP_SUMMARY
          echo "| Panel Tests | $(status_icon $PANELS) $PANELS |" >> $GITHUB_STEP_SUMMARY
          echo "| Feature Tests | $(status_icon $FEATURES) $FEATURES |" >> $GITHUB_STEP_SUMMARY
          echo "| Settings Tests | $(status_icon $SETTINGS) $SETTINGS |" >> $GITHUB_STEP_SUMMARY
          echo "| UI Elements | $(status_icon $UI_ELEMENTS) $UI_ELEMENTS |" >> $GITHUB_STEP_SUMMARY
          echo "| Comprehensive UI | $(status_icon $COMPREHENSIVE) $COMPREHENSIVE |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Passed:** $SUCCESS_COUNT / 7" >> $GITHUB_STEP_SUMMARY
          echo "- **Failed:** $FAILURE_COUNT / 7" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          if [ "$FAILURE_COUNT" -eq "0" ]; then
            echo "### All Tests Passed! ğŸ‰" >> $GITHUB_STEP_SUMMARY
          else
            echo "### Some Tests Failed" >> $GITHUB_STEP_SUMMARY
            echo "Check individual job logs for details." >> $GITHUB_STEP_SUMMARY
          fi

      - name: âŒ Fail if any tests failed
        if: contains(needs.*.result, 'failure')
        run: exit 1

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ“¤ ARTIFACTS - Upload test reports
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  upload-artifacts:
    runs-on: ubuntu-latest
    needs: [test-new-game, test-debug-commands, test-panels, test-features, test-settings, test-ui-elements, test-comprehensive-ui]
    if: always()
    steps:
      - name: ğŸ”„ Checkout
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“¥ Install dependencies
        run: npm ci

      - name: ğŸ­ Install Playwright browsers
        run: npx playwright install --with-deps chromium

      - name: ğŸ§ª Run all tests for report
        continue-on-error: true
        run: npx playwright test --reporter=html

      - name: ğŸ“¤ Upload HTML report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: playwright-report
          path: playwright-report/
          retention-days: 30

      - name: ğŸ“¤ Upload screenshots on failure
        uses: actions/upload-artifact@v4
        if: failure()
        with:
          name: test-screenshots
          path: test-results/
          retention-days: 7
